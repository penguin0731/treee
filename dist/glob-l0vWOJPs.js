import{g as t}from"./commander-CXs82Ous.js";import{win32 as e,posix as s}from"path";import{fileURLToPath as i}from"url";import*as r from"fs";import{realpathSync as n,lstatSync as h,readdir as o,readdirSync as a,readlinkSync as l}from"fs";import{lstat as c,readdir as p,readlink as d,realpath as u}from"fs/promises";import{EventEmitter as f}from"events";import g from"stream";import{StringDecoder as m}from"string_decoder";var w=y;function y(t,e,s){t instanceof RegExp&&(t=b(t,s)),e instanceof RegExp&&(e=b(e,s));var i=v(t,e,s);return i&&{start:i[0],end:i[1],pre:s.slice(0,i[0]),body:s.slice(i[0]+t.length,i[1]),post:s.slice(i[1]+e.length)}}function b(t,e){var s=e.match(t);return s?s[0]:null}function v(t,e,s){var i,r,n,h,o,a=s.indexOf(t),l=s.indexOf(e,a+1),c=a;if(a>=0&&l>0){if(t===e)return[a,l];for(i=[],n=s.length;c>=0&&!o;)c==a?(i.push(c),a=s.indexOf(t,c+1)):1==i.length?o=[i.pop(),l]:((r=i.pop())<n&&(n=r,h=l),l=s.indexOf(e,c+1)),c=a<l&&a>=0?a:l;i.length&&(o=[n,h])}return o}y.range=v;var S=w,k=function(t){if(!t)return[];"{}"===t.substr(0,2)&&(t="\\{\\}"+t.substr(2));return P(function(t){return t.split("\\\\").join(x).split("\\{").join(E).split("\\}").join(L).split("\\,").join(T).split("\\.").join(A)}(t),!0).map(C)},x="\0SLASH"+Math.random()+"\0",E="\0OPEN"+Math.random()+"\0",L="\0CLOSE"+Math.random()+"\0",T="\0COMMA"+Math.random()+"\0",A="\0PERIOD"+Math.random()+"\0";function F(t){return parseInt(t,10)==t?parseInt(t,10):t.charCodeAt(0)}function C(t){return t.split(x).join("\\").split(E).join("{").split(L).join("}").split(T).join(",").split(A).join(".")}function O(t){if(!t)return[""];var e=[],s=S("{","}",t);if(!s)return t.split(",");var i=s.pre,r=s.body,n=s.post,h=i.split(",");h[h.length-1]+="{"+r+"}";var o=O(n);return n.length&&(h[h.length-1]+=o.shift(),h.push.apply(h,o)),e.push.apply(e,h),e}function z(t){return"{"+t+"}"}function M(t){return/^-?0\d/.test(t)}function R(t,e){return t<=e}function N(t,e){return t>=e}function P(t,e){var s=[],i=S("{","}",t);if(!i)return[t];var r=i.pre,n=i.post.length?P(i.post,!1):[""];if(/\$$/.test(i.pre))for(var h=0;h<n.length;h++){var o=r+"{"+i.body+"}"+n[h];s.push(o)}else{var a,l,c=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(i.body),p=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(i.body),d=c||p,u=i.body.indexOf(",")>=0;if(!d&&!u)return i.post.match(/,.*\}/)?P(t=i.pre+"{"+i.body+L+i.post):[t];if(d)a=i.body.split(/\.\./);else if(1===(a=O(i.body)).length&&1===(a=P(a[0],!1).map(z)).length)return n.map((function(t){return i.pre+a[0]+t}));if(d){var f=F(a[0]),g=F(a[1]),m=Math.max(a[0].length,a[1].length),w=3==a.length?Math.abs(F(a[2])):1,y=R;g<f&&(w*=-1,y=N);var b=a.some(M);l=[];for(var v=f;y(v,g);v+=w){var k;if(p)"\\"===(k=String.fromCharCode(v))&&(k="");else if(k=String(v),b){var x=m-k.length;if(x>0){var E=new Array(x+1).join("0");k=v<0?"-"+E+k.slice(1):E+k}}l.push(k)}}else{l=[];for(var T=0;T<a.length;T++)l.push.apply(l,P(a[T],!1))}for(T=0;T<l.length;T++)for(h=0;h<n.length;h++){o=r+l[T]+n[h];(!e||d||o)&&s.push(o)}}return s}var D=t(k);const _=t=>{if("string"!=typeof t)throw new TypeError("invalid pattern");if(t.length>65536)throw new TypeError("pattern is too long")},B={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},j=t=>t.replace(/[[\]\\-]/g,"\\$&"),W=t=>t.join(""),I=(t,e)=>{const s=e;if("["!==t.charAt(s))throw new Error("not in a brace expression");const i=[],r=[];let n=s+1,h=!1,o=!1,a=!1,l=!1,c=s,p="";t:for(;n<t.length;){const e=t.charAt(n);if("!"!==e&&"^"!==e||n!==s+1){if("]"===e&&h&&!a){c=n+1;break}if(h=!0,"\\"!==e||a){if("["===e&&!a)for(const[e,[h,a,l]]of Object.entries(B))if(t.startsWith(e,n)){if(p)return["$.",!1,t.length-s,!0];n+=e.length,l?r.push(h):i.push(h),o=o||a;continue t}a=!1,p?(e>p?i.push(j(p)+"-"+j(e)):e===p&&i.push(j(e)),p="",n++):t.startsWith("-]",n+1)?(i.push(j(e+"-")),n+=2):t.startsWith("-",n+1)?(p=e,n+=2):(i.push(j(e)),n++)}else a=!0,n++}else l=!0,n++}if(c<n)return["",!1,0,!1];if(!i.length&&!r.length)return["$.",!1,t.length-s,!0];if(0===r.length&&1===i.length&&/^\\?.$/.test(i[0])&&!l){const t=2===i[0].length?i[0].slice(-1):i[0];return[(d=t,d.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")),!1,c-s,!1]}var d;const u="["+(l?"^":"")+W(i)+"]",f="["+(l?"":"^")+W(r)+"]";return[i.length&&r.length?"("+u+"|"+f+")":i.length?u:f,o,c-s,!0]},$=(t,{windowsPathsNoEscape:e=!1}={})=>e?t.replace(/\[([^\/\\])\]/g,"$1"):t.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1"),U=new Set(["!","?","+","*","@"]),G=t=>U.has(t),H="(?!\\.)",q=new Set(["[","."]),V=new Set(["..","."]),Z=new Set("().*{}+?[]^$\\!"),J="[^/]",K=J+"*?",Y=J+"+?";class X{type;#t;#e;#s=!1;#i=[];#r;#n;#h;#o=!1;#a;#l;#c=!1;constructor(t,e,s={}){this.type=t,t&&(this.#e=!0),this.#r=e,this.#t=this.#r?this.#r.#t:this,this.#a=this.#t===this?s:this.#t.#a,this.#h=this.#t===this?[]:this.#t.#h,"!"!==t||this.#t.#o||this.#h.push(this),this.#n=this.#r?this.#r.#i.length:0}get hasMagic(){if(void 0!==this.#e)return this.#e;for(const t of this.#i)if("string"!=typeof t&&(t.type||t.hasMagic))return this.#e=!0;return this.#e}toString(){return void 0!==this.#l?this.#l:this.type?this.#l=this.type+"("+this.#i.map((t=>String(t))).join("|")+")":this.#l=this.#i.map((t=>String(t))).join("")}#p(){if(this!==this.#t)throw new Error("should only call on root");if(this.#o)return this;let t;for(this.toString(),this.#o=!0;t=this.#h.pop();){if("!"!==t.type)continue;let e=t,s=e.#r;for(;s;){for(let i=e.#n+1;!s.type&&i<s.#i.length;i++)for(const e of t.#i){if("string"==typeof e)throw new Error("string part in extglob AST??");e.copyIn(s.#i[i])}e=s,s=e.#r}}return this}push(...t){for(const e of t)if(""!==e){if("string"!=typeof e&&!(e instanceof X&&e.#r===this))throw new Error("invalid part: "+e);this.#i.push(e)}}toJSON(){const t=null===this.type?this.#i.slice().map((t=>"string"==typeof t?t:t.toJSON())):[this.type,...this.#i.map((t=>t.toJSON()))];return this.isStart()&&!this.type&&t.unshift([]),this.isEnd()&&(this===this.#t||this.#t.#o&&"!"===this.#r?.type)&&t.push({}),t}isStart(){if(this.#t===this)return!0;if(!this.#r?.isStart())return!1;if(0===this.#n)return!0;const t=this.#r;for(let e=0;e<this.#n;e++){const s=t.#i[e];if(!(s instanceof X&&"!"===s.type))return!1}return!0}isEnd(){if(this.#t===this)return!0;if("!"===this.#r?.type)return!0;if(!this.#r?.isEnd())return!1;if(!this.type)return this.#r?.isEnd();const t=this.#r?this.#r.#i.length:0;return this.#n===t-1}copyIn(t){"string"==typeof t?this.push(t):this.push(t.clone(this))}clone(t){const e=new X(this.type,t);for(const t of this.#i)e.copyIn(t);return e}static#d(t,e,s,i){let r=!1,n=!1,h=-1,o=!1;if(null===e.type){let a=s,l="";for(;a<t.length;){const s=t.charAt(a++);if(r||"\\"===s)r=!r,l+=s;else if(n)a===h+1?"^"!==s&&"!"!==s||(o=!0):"]"!==s||a===h+2&&o||(n=!1),l+=s;else if("["!==s)if(i.noext||!G(s)||"("!==t.charAt(a))l+=s;else{e.push(l),l="";const r=new X(s,e);a=X.#d(t,r,a,i),e.push(r)}else n=!0,h=a,o=!1,l+=s}return e.push(l),a}let a=s+1,l=new X(null,e);const c=[];let p="";for(;a<t.length;){const s=t.charAt(a++);if(r||"\\"===s)r=!r,p+=s;else if(n)a===h+1?"^"!==s&&"!"!==s||(o=!0):"]"!==s||a===h+2&&o||(n=!1),p+=s;else if("["!==s)if(G(s)&&"("===t.charAt(a)){l.push(p),p="";const e=new X(s,l);l.push(e),a=X.#d(t,e,a,i)}else if("|"!==s){if(")"===s)return""===p&&0===e.#i.length&&(e.#c=!0),l.push(p),p="",e.push(...c,l),a;p+=s}else l.push(p),p="",c.push(l),l=new X(null,e);else n=!0,h=a,o=!1,p+=s}return e.type=null,e.#e=void 0,e.#i=[t.substring(s-1)],a}static fromGlob(t,e={}){const s=new X(null,void 0,e);return X.#d(t,s,0,e),s}toMMPattern(){if(this!==this.#t)return this.#t.toMMPattern();const t=this.toString(),[e,s,i,r]=this.toRegExpSource();if(!(i||this.#e||this.#a.nocase&&!this.#a.nocaseMagicOnly&&t.toUpperCase()!==t.toLowerCase()))return s;const n=(this.#a.nocase?"i":"")+(r?"u":"");return Object.assign(new RegExp(`^${e}$`,n),{_src:e,_glob:t})}toRegExpSource(t){const e=t??!!this.#a.dot;if(this.#t===this&&this.#p(),!this.type){const s=this.isStart()&&this.isEnd(),i=this.#i.map((e=>{const[i,r,n,h]="string"==typeof e?X.#u(e,this.#e,s):e.toRegExpSource(t);return this.#e=this.#e||n,this.#s=this.#s||h,i})).join("");let r="";if(this.isStart()&&"string"==typeof this.#i[0]){if(!(1===this.#i.length&&V.has(this.#i[0]))){const s=q,n=e&&s.has(i.charAt(0))||i.startsWith("\\.")&&s.has(i.charAt(2))||i.startsWith("\\.\\.")&&s.has(i.charAt(4)),h=!e&&!t&&s.has(i.charAt(0));r=n?"(?!(?:^|/)\\.\\.?(?:$|/))":h?H:""}}let n="";this.isEnd()&&this.#t.#o&&"!"===this.#r?.type&&(n="(?:$|\\/)");return[r+i+n,$(i),this.#e=!!this.#e,this.#s]}const s="*"===this.type||"+"===this.type,i="!"===this.type?"(?:(?!(?:":"(?:";let r=this.#f(e);if(this.isStart()&&this.isEnd()&&!r&&"!"!==this.type){const t=this.toString();return this.#i=[t],this.type=null,this.#e=void 0,[t,$(this.toString()),!1,!1]}let n=!s||t||e?"":this.#f(!0);n===r&&(n=""),n&&(r=`(?:${r})(?:${n})*?`);let h="";if("!"===this.type&&this.#c)h=(this.isStart()&&!e?H:"")+Y;else{h=i+r+("!"===this.type?"))"+(!this.isStart()||e||t?"":H)+K+")":"@"===this.type?")":"?"===this.type?")?":"+"===this.type&&n?")":"*"===this.type&&n?")?":`)${this.type}`)}return[h,$(r),this.#e=!!this.#e,this.#s]}#f(t){return this.#i.map((e=>{if("string"==typeof e)throw new Error("string type in extglob ast??");const[s,i,r,n]=e.toRegExpSource(t);return this.#s=this.#s||n,s})).filter((t=>!(this.isStart()&&this.isEnd()&&!t))).join("|")}static#u(t,e,s=!1){let i=!1,r="",n=!1;for(let h=0;h<t.length;h++){const o=t.charAt(h);if(i)i=!1,r+=(Z.has(o)?"\\":"")+o;else if("\\"!==o){if("["===o){const[s,i,o,a]=I(t,h);if(o){r+=s,n=n||i,h+=o-1,e=e||a;continue}}"*"!==o?"?"!==o?r+=o.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):(r+=J,e=!0):(r+=s&&"*"===t?Y:K,e=!0)}else h===t.length-1?r+="\\\\":i=!0}return[r,$(t),!!e,n]}}const Q=(t,{windowsPathsNoEscape:e=!1}={})=>e?t.replace(/[?*()[\]]/g,"[$&]"):t.replace(/[?*()[\]\\]/g,"\\$&"),tt=(t,e,s={})=>(_(e),!(!s.nocomment&&"#"===e.charAt(0))&&new Tt(e,s).match(t)),et=/^\*+([^+@!?\*\[\(]*)$/,st=t=>e=>!e.startsWith(".")&&e.endsWith(t),it=t=>e=>e.endsWith(t),rt=t=>(t=t.toLowerCase(),e=>!e.startsWith(".")&&e.toLowerCase().endsWith(t)),nt=t=>(t=t.toLowerCase(),e=>e.toLowerCase().endsWith(t)),ht=/^\*+\.\*+$/,ot=t=>!t.startsWith(".")&&t.includes("."),at=t=>"."!==t&&".."!==t&&t.includes("."),lt=/^\.\*+$/,ct=t=>"."!==t&&".."!==t&&t.startsWith("."),pt=/^\*+$/,dt=t=>0!==t.length&&!t.startsWith("."),ut=t=>0!==t.length&&"."!==t&&".."!==t,ft=/^\?+([^+@!?\*\[\(]*)?$/,gt=([t,e=""])=>{const s=bt([t]);return e?(e=e.toLowerCase(),t=>s(t)&&t.toLowerCase().endsWith(e)):s},mt=([t,e=""])=>{const s=vt([t]);return e?(e=e.toLowerCase(),t=>s(t)&&t.toLowerCase().endsWith(e)):s},wt=([t,e=""])=>{const s=vt([t]);return e?t=>s(t)&&t.endsWith(e):s},yt=([t,e=""])=>{const s=bt([t]);return e?t=>s(t)&&t.endsWith(e):s},bt=([t])=>{const e=t.length;return t=>t.length===e&&!t.startsWith(".")},vt=([t])=>{const e=t.length;return t=>t.length===e&&"."!==t&&".."!==t},St="object"==typeof process&&process?"object"==typeof process.env&&process.env&&process.env.__MINIMATCH_TESTING_PLATFORM__||process.platform:"posix";tt.sep="win32"===St?{sep:"\\"}.sep:{sep:"/"}.sep;const kt=Symbol("globstar **");tt.GLOBSTAR=kt;tt.filter=(t,e={})=>s=>tt(s,t,e);const xt=(t,e={})=>Object.assign({},t,e);tt.defaults=t=>{if(!t||"object"!=typeof t||!Object.keys(t).length)return tt;const e=tt;return Object.assign(((s,i,r={})=>e(s,i,xt(t,r))),{Minimatch:class extends e.Minimatch{constructor(e,s={}){super(e,xt(t,s))}static defaults(s){return e.defaults(xt(t,s)).Minimatch}},AST:class extends e.AST{constructor(e,s,i={}){super(e,s,xt(t,i))}static fromGlob(s,i={}){return e.AST.fromGlob(s,xt(t,i))}},unescape:(s,i={})=>e.unescape(s,xt(t,i)),escape:(s,i={})=>e.escape(s,xt(t,i)),filter:(s,i={})=>e.filter(s,xt(t,i)),defaults:s=>e.defaults(xt(t,s)),makeRe:(s,i={})=>e.makeRe(s,xt(t,i)),braceExpand:(s,i={})=>e.braceExpand(s,xt(t,i)),match:(s,i,r={})=>e.match(s,i,xt(t,r)),sep:e.sep,GLOBSTAR:kt})};const Et=(t,e={})=>(_(t),e.nobrace||!/\{(?:(?!\{).)*\}/.test(t)?[t]:D(t));tt.braceExpand=Et;tt.makeRe=(t,e={})=>new Tt(t,e).makeRe();tt.match=(t,e,s={})=>{const i=new Tt(e,s);return t=t.filter((t=>i.match(t))),i.options.nonull&&!t.length&&t.push(e),t};const Lt=/[?*]|[+@!]\(.*?\)|\[|\]/;class Tt{options;set;pattern;windowsPathsNoEscape;nonegate;negate;comment;empty;preserveMultipleSlashes;partial;globSet;globParts;nocase;isWindows;platform;windowsNoMagicRoot;regexp;constructor(t,e={}){_(t),e=e||{},this.options=e,this.pattern=t,this.platform=e.platform||St,this.isWindows="win32"===this.platform,this.windowsPathsNoEscape=!!e.windowsPathsNoEscape||!1===e.allowWindowsEscape,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!e.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!e.nonegate,this.comment=!1,this.empty=!1,this.partial=!!e.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=void 0!==e.windowsNoMagicRoot?e.windowsNoMagicRoot:!(!this.isWindows||!this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(const t of this.set)for(const e of t)if("string"!=typeof e)return!0;return!1}debug(...t){}make(){const t=this.pattern,e=this.options;if(!e.nocomment&&"#"===t.charAt(0))return void(this.comment=!0);if(!t)return void(this.empty=!0);this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],e.debug&&(this.debug=(...t)=>console.error(...t)),this.debug(this.pattern,this.globSet);const s=this.globSet.map((t=>this.slashSplit(t)));this.globParts=this.preprocess(s),this.debug(this.pattern,this.globParts);let i=this.globParts.map(((t,e,s)=>{if(this.isWindows&&this.windowsNoMagicRoot){const e=!(""!==t[0]||""!==t[1]||"?"!==t[2]&&Lt.test(t[2])||Lt.test(t[3])),s=/^[a-z]:/i.test(t[0]);if(e)return[...t.slice(0,4),...t.slice(4).map((t=>this.parse(t)))];if(s)return[t[0],...t.slice(1).map((t=>this.parse(t)))]}return t.map((t=>this.parse(t)))}));if(this.debug(this.pattern,i),this.set=i.filter((t=>-1===t.indexOf(!1))),this.isWindows)for(let t=0;t<this.set.length;t++){const e=this.set[t];""===e[0]&&""===e[1]&&"?"===this.globParts[t][2]&&"string"==typeof e[3]&&/^[a-z]:$/i.test(e[3])&&(e[2]="?")}this.debug(this.pattern,this.set)}preprocess(t){if(this.options.noglobstar)for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++)"**"===t[e][s]&&(t[e][s]="*");const{optimizationLevel:e=1}=this.options;return e>=2?(t=this.firstPhasePreProcess(t),t=this.secondPhasePreProcess(t)):t=e>=1?this.levelOneOptimize(t):this.adjascentGlobstarOptimize(t),t}adjascentGlobstarOptimize(t){return t.map((t=>{let e=-1;for(;-1!==(e=t.indexOf("**",e+1));){let s=e;for(;"**"===t[s+1];)s++;s!==e&&t.splice(e,s-e)}return t}))}levelOneOptimize(t){return t.map((t=>0===(t=t.reduce(((t,e)=>{const s=t[t.length-1];return"**"===e&&"**"===s?t:".."===e&&s&&".."!==s&&"."!==s&&"**"!==s?(t.pop(),t):(t.push(e),t)}),[])).length?[""]:t))}levelTwoFileOptimize(t){Array.isArray(t)||(t=this.slashSplit(t));let e=!1;do{if(e=!1,!this.preserveMultipleSlashes){for(let s=1;s<t.length-1;s++){const i=t[s];1===s&&""===i&&""===t[0]||("."!==i&&""!==i||(e=!0,t.splice(s,1),s--))}"."!==t[0]||2!==t.length||"."!==t[1]&&""!==t[1]||(e=!0,t.pop())}let s=0;for(;-1!==(s=t.indexOf("..",s+1));){const i=t[s-1];i&&"."!==i&&".."!==i&&"**"!==i&&(e=!0,t.splice(s-1,2),s-=2)}}while(e);return 0===t.length?[""]:t}firstPhasePreProcess(t){let e=!1;do{e=!1;for(let s of t){let i=-1;for(;-1!==(i=s.indexOf("**",i+1));){let r=i;for(;"**"===s[r+1];)r++;r>i&&s.splice(i+1,r-i);let n=s[i+1];const h=s[i+2],o=s[i+3];if(".."!==n)continue;if(!h||"."===h||".."===h||!o||"."===o||".."===o)continue;e=!0,s.splice(i,1);const a=s.slice(0);a[i]="**",t.push(a),i--}if(!this.preserveMultipleSlashes){for(let t=1;t<s.length-1;t++){const i=s[t];1===t&&""===i&&""===s[0]||("."!==i&&""!==i||(e=!0,s.splice(t,1),t--))}"."!==s[0]||2!==s.length||"."!==s[1]&&""!==s[1]||(e=!0,s.pop())}let r=0;for(;-1!==(r=s.indexOf("..",r+1));){const t=s[r-1];if(t&&"."!==t&&".."!==t&&"**"!==t){e=!0;const t=1===r&&"**"===s[r+1]?["."]:[];s.splice(r-1,2,...t),0===s.length&&s.push(""),r-=2}}}}while(e);return t}secondPhasePreProcess(t){for(let e=0;e<t.length-1;e++)for(let s=e+1;s<t.length;s++){const i=this.partsMatch(t[e],t[s],!this.preserveMultipleSlashes);i&&(t[e]=i,t[s]=[])}return t.filter((t=>t.length))}partsMatch(t,e,s=!1){let i=0,r=0,n=[],h="";for(;i<t.length&&r<e.length;)if(t[i]===e[r])n.push("b"===h?e[r]:t[i]),i++,r++;else if(s&&"**"===t[i]&&e[r]===t[i+1])n.push(t[i]),i++;else if(s&&"**"===e[r]&&t[i]===e[r+1])n.push(e[r]),r++;else if("*"!==t[i]||!e[r]||!this.options.dot&&e[r].startsWith(".")||"**"===e[r]){if("*"!==e[r]||!t[i]||!this.options.dot&&t[i].startsWith(".")||"**"===t[i])return!1;if("a"===h)return!1;h="b",n.push(e[r]),i++,r++}else{if("b"===h)return!1;h="a",n.push(t[i]),i++,r++}return t.length===e.length&&n}parseNegate(){if(this.nonegate)return;const t=this.pattern;let e=!1,s=0;for(let i=0;i<t.length&&"!"===t.charAt(i);i++)e=!e,s++;s&&(this.pattern=t.slice(s)),this.negate=e}matchOne(t,e,s=!1){const i=this.options;if(this.isWindows){const s="string"==typeof t[0]&&/^[a-z]:$/i.test(t[0]),i=!s&&""===t[0]&&""===t[1]&&"?"===t[2]&&/^[a-z]:$/i.test(t[3]),r="string"==typeof e[0]&&/^[a-z]:$/i.test(e[0]),n=i?3:s?0:void 0,h=!r&&""===e[0]&&""===e[1]&&"?"===e[2]&&"string"==typeof e[3]&&/^[a-z]:$/i.test(e[3])?3:r?0:void 0;if("number"==typeof n&&"number"==typeof h){const[s,i]=[t[n],e[h]];s.toLowerCase()===i.toLowerCase()&&(e[h]=s,h>n?e=e.slice(h):n>h&&(t=t.slice(n)))}}const{optimizationLevel:r=1}=this.options;r>=2&&(t=this.levelTwoFileOptimize(t)),this.debug("matchOne",this,{file:t,pattern:e}),this.debug("matchOne",t.length,e.length);for(var n=0,h=0,o=t.length,a=e.length;n<o&&h<a;n++,h++){this.debug("matchOne loop");var l=e[h],c=t[n];if(this.debug(e,l,c),!1===l)return!1;if(l===kt){this.debug("GLOBSTAR",[e,l,c]);var p=n,d=h+1;if(d===a){for(this.debug("** at the end");n<o;n++)if("."===t[n]||".."===t[n]||!i.dot&&"."===t[n].charAt(0))return!1;return!0}for(;p<o;){var u=t[p];if(this.debug("\nglobstar while",t,p,e,d,u),this.matchOne(t.slice(p),e.slice(d),s))return this.debug("globstar found match!",p,o,u),!0;if("."===u||".."===u||!i.dot&&"."===u.charAt(0)){this.debug("dot detected!",t,p,e,d);break}this.debug("globstar swallow a segment, and continue"),p++}return!(!s||(this.debug("\n>>> no match, partial?",t,p,e,d),p!==o))}let r;if("string"==typeof l?(r=c===l,this.debug("string match",l,c,r)):(r=l.test(c),this.debug("pattern match",l,c,r)),!r)return!1}if(n===o&&h===a)return!0;if(n===o)return s;if(h===a)return n===o-1&&""===t[n];throw new Error("wtf?")}braceExpand(){return Et(this.pattern,this.options)}parse(t){_(t);const e=this.options;if("**"===t)return kt;if(""===t)return"";let s,i=null;(s=t.match(pt))?i=e.dot?ut:dt:(s=t.match(et))?i=(e.nocase?e.dot?nt:rt:e.dot?it:st)(s[1]):(s=t.match(ft))?i=(e.nocase?e.dot?mt:gt:e.dot?wt:yt)(s):(s=t.match(ht))?i=e.dot?at:ot:(s=t.match(lt))&&(i=ct);const r=X.fromGlob(t,this.options).toMMPattern();return i?Object.assign(r,{test:i}):r}makeRe(){if(this.regexp||!1===this.regexp)return this.regexp;const t=this.set;if(!t.length)return this.regexp=!1,this.regexp;const e=this.options,s=e.noglobstar?"[^/]*?":e.dot?"(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?":"(?:(?!(?:\\/|^)\\.).)*?",i=new Set(e.nocase?["i"]:[]);let r=t.map((t=>{const e=t.map((t=>{if(t instanceof RegExp)for(const e of t.flags.split(""))i.add(e);return"string"==typeof t?t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):t===kt?kt:t._src}));return e.forEach(((t,i)=>{const r=e[i+1],n=e[i-1];t===kt&&n!==kt&&(void 0===n?void 0!==r&&r!==kt?e[i+1]="(?:\\/|"+s+"\\/)?"+r:e[i]=s:void 0===r?e[i-1]=n+"(?:\\/|"+s+")?":r!==kt&&(e[i-1]=n+"(?:\\/|\\/"+s+"\\/)"+r,e[i+1]=kt))})),e.filter((t=>t!==kt)).join("/")})).join("|");const[n,h]=t.length>1?["(?:",")"]:["",""];r="^"+n+r+h+"$",this.negate&&(r="^(?!"+r+").+$");try{this.regexp=new RegExp(r,[...i].join(""))}catch(t){this.regexp=!1}return this.regexp}slashSplit(t){return this.preserveMultipleSlashes?t.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(t)?["",...t.split(/\/+/)]:t.split(/\/+/)}match(t,e=this.partial){if(this.debug("match",t,this.pattern),this.comment)return!1;if(this.empty)return""===t;if("/"===t&&e)return!0;const s=this.options;this.isWindows&&(t=t.split("\\").join("/"));const i=this.slashSplit(t);this.debug(this.pattern,"split",i);const r=this.set;this.debug(this.pattern,"set",r);let n=i[i.length-1];if(!n)for(let t=i.length-2;!n&&t>=0;t--)n=i[t];for(let t=0;t<r.length;t++){const h=r[t];let o=i;s.matchBase&&1===h.length&&(o=[n]);if(this.matchOne(o,h,e))return!!s.flipNegate||!this.negate}return!s.flipNegate&&this.negate}static defaults(t){return tt.defaults(t).Minimatch}}tt.AST=X,tt.Minimatch=Tt,tt.escape=Q,tt.unescape=$;const At="object"==typeof performance&&performance&&"function"==typeof performance.now?performance:Date,Ft=new Set,Ct="object"==typeof process&&process?process:{},Ot=(t,e,s,i)=>{"function"==typeof Ct.emitWarning?Ct.emitWarning(t,e,s,i):console.error(`[${s}] ${e}: ${t}`)};let zt=globalThis.AbortController,Mt=globalThis.AbortSignal;if(void 0===zt){Mt=class{onabort;_onabort=[];reason;aborted=!1;addEventListener(t,e){this._onabort.push(e)}},zt=class{constructor(){e()}signal=new Mt;abort(t){if(!this.signal.aborted){this.signal.reason=t,this.signal.aborted=!0;for(const e of this.signal._onabort)e(t);this.signal.onabort?.(t)}}};let t="1"!==Ct.env?.LRU_CACHE_IGNORE_AC_WARNING;const e=()=>{t&&(t=!1,Ot("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",e))}}const Rt=t=>t&&t===Math.floor(t)&&t>0&&isFinite(t),Nt=t=>Rt(t)?t<=Math.pow(2,8)?Uint8Array:t<=Math.pow(2,16)?Uint16Array:t<=Math.pow(2,32)?Uint32Array:t<=Number.MAX_SAFE_INTEGER?Pt:null:null;class Pt extends Array{constructor(t){super(t),this.fill(0)}}class Dt{heap;length;static#g=!1;static create(t){const e=Nt(t);if(!e)return[];Dt.#g=!0;const s=new Dt(t,e);return Dt.#g=!1,s}constructor(t,e){if(!Dt.#g)throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new e(t),this.length=0}push(t){this.heap[this.length++]=t}pop(){return this.heap[--this.length]}}class _t{#m;#w;#y;#b;#v;ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#S;#k;#x;#E;#L;#T;#A;#F;#C;#O;#z;#M;#R;#N;#P;#D;#_;static unsafeExposeInternals(t){return{starts:t.#R,ttls:t.#N,sizes:t.#M,keyMap:t.#x,keyList:t.#E,valList:t.#L,next:t.#T,prev:t.#A,get head(){return t.#F},get tail(){return t.#C},free:t.#O,isBackgroundFetch:e=>t.#B(e),backgroundFetch:(e,s,i,r)=>t.#j(e,s,i,r),moveToTail:e=>t.#W(e),indexes:e=>t.#I(e),rindexes:e=>t.#$(e),isStale:e=>t.#U(e)}}get max(){return this.#m}get maxSize(){return this.#w}get calculatedSize(){return this.#k}get size(){return this.#S}get fetchMethod(){return this.#v}get dispose(){return this.#y}get disposeAfter(){return this.#b}constructor(t){const{max:e=0,ttl:s,ttlResolution:i=1,ttlAutopurge:r,updateAgeOnGet:n,updateAgeOnHas:h,allowStale:o,dispose:a,disposeAfter:l,noDisposeOnSet:c,noUpdateTTL:p,maxSize:d=0,maxEntrySize:u=0,sizeCalculation:f,fetchMethod:g,noDeleteOnFetchRejection:m,noDeleteOnStaleGet:w,allowStaleOnFetchRejection:y,allowStaleOnFetchAbort:b,ignoreFetchAbort:v}=t;if(0!==e&&!Rt(e))throw new TypeError("max option must be a nonnegative integer");const S=e?Nt(e):Array;if(!S)throw new Error("invalid max value: "+e);if(this.#m=e,this.#w=d,this.maxEntrySize=u||this.#w,this.sizeCalculation=f,this.sizeCalculation){if(!this.#w&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if("function"!=typeof this.sizeCalculation)throw new TypeError("sizeCalculation set to non-function")}if(void 0!==g&&"function"!=typeof g)throw new TypeError("fetchMethod must be a function if specified");if(this.#v=g,this.#D=!!g,this.#x=new Map,this.#E=new Array(e).fill(void 0),this.#L=new Array(e).fill(void 0),this.#T=new S(e),this.#A=new S(e),this.#F=0,this.#C=0,this.#O=Dt.create(e),this.#S=0,this.#k=0,"function"==typeof a&&(this.#y=a),"function"==typeof l?(this.#b=l,this.#z=[]):(this.#b=void 0,this.#z=void 0),this.#P=!!this.#y,this.#_=!!this.#b,this.noDisposeOnSet=!!c,this.noUpdateTTL=!!p,this.noDeleteOnFetchRejection=!!m,this.allowStaleOnFetchRejection=!!y,this.allowStaleOnFetchAbort=!!b,this.ignoreFetchAbort=!!v,0!==this.maxEntrySize){if(0!==this.#w&&!Rt(this.#w))throw new TypeError("maxSize must be a positive integer if specified");if(!Rt(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.#G()}if(this.allowStale=!!o,this.noDeleteOnStaleGet=!!w,this.updateAgeOnGet=!!n,this.updateAgeOnHas=!!h,this.ttlResolution=Rt(i)||0===i?i:1,this.ttlAutopurge=!!r,this.ttl=s||0,this.ttl){if(!Rt(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.#H()}if(0===this.#m&&0===this.ttl&&0===this.#w)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#m&&!this.#w){const t="LRU_CACHE_UNBOUNDED";if((t=>!Ft.has(t))(t)){Ft.add(t);Ot("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",t,_t)}}}getRemainingTTL(t){return this.#x.has(t)?1/0:0}#H(){const t=new Pt(this.#m),e=new Pt(this.#m);this.#N=t,this.#R=e,this.#q=(s,i,r=At.now())=>{if(e[s]=0!==i?r:0,t[s]=i,0!==i&&this.ttlAutopurge){const t=setTimeout((()=>{this.#U(s)&&this.delete(this.#E[s])}),i+1);t.unref&&t.unref()}},this.#V=s=>{e[s]=0!==t[s]?At.now():0},this.#Z=(r,n)=>{if(t[n]){const h=t[n],o=e[n];if(!h||!o)return;r.ttl=h,r.start=o,r.now=s||i();const a=r.now-o;r.remainingTTL=h-a}};let s=0;const i=()=>{const t=At.now();if(this.ttlResolution>0){s=t;const e=setTimeout((()=>s=0),this.ttlResolution);e.unref&&e.unref()}return t};this.getRemainingTTL=r=>{const n=this.#x.get(r);if(void 0===n)return 0;const h=t[n],o=e[n];if(!h||!o)return 1/0;return h-((s||i())-o)},this.#U=r=>{const n=e[r],h=t[r];return!!h&&!!n&&(s||i())-n>h}}#V=()=>{};#Z=()=>{};#q=()=>{};#U=()=>!1;#G(){const t=new Pt(this.#m);this.#k=0,this.#M=t,this.#J=e=>{this.#k-=t[e],t[e]=0},this.#K=(t,e,s,i)=>{if(this.#B(e))return 0;if(!Rt(s)){if(!i)throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");if("function"!=typeof i)throw new TypeError("sizeCalculation must be a function");if(s=i(e,t),!Rt(s))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}return s},this.#Y=(e,s,i)=>{if(t[e]=s,this.#w){const s=this.#w-t[e];for(;this.#k>s;)this.#X(!0)}this.#k+=t[e],i&&(i.entrySize=s,i.totalCalculatedSize=this.#k)}}#J=t=>{};#Y=(t,e,s)=>{};#K=(t,e,s,i)=>{if(s||i)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0};*#I({allowStale:t=this.allowStale}={}){if(this.#S)for(let e=this.#C;this.#Q(e)&&(!t&&this.#U(e)||(yield e),e!==this.#F);)e=this.#A[e]}*#$({allowStale:t=this.allowStale}={}){if(this.#S)for(let e=this.#F;this.#Q(e)&&(!t&&this.#U(e)||(yield e),e!==this.#C);)e=this.#T[e]}#Q(t){return void 0!==t&&this.#x.get(this.#E[t])===t}*entries(){for(const t of this.#I())void 0===this.#L[t]||void 0===this.#E[t]||this.#B(this.#L[t])||(yield[this.#E[t],this.#L[t]])}*rentries(){for(const t of this.#$())void 0===this.#L[t]||void 0===this.#E[t]||this.#B(this.#L[t])||(yield[this.#E[t],this.#L[t]])}*keys(){for(const t of this.#I()){const e=this.#E[t];void 0===e||this.#B(this.#L[t])||(yield e)}}*rkeys(){for(const t of this.#$()){const e=this.#E[t];void 0===e||this.#B(this.#L[t])||(yield e)}}*values(){for(const t of this.#I()){void 0===this.#L[t]||this.#B(this.#L[t])||(yield this.#L[t])}}*rvalues(){for(const t of this.#$()){void 0===this.#L[t]||this.#B(this.#L[t])||(yield this.#L[t])}}[Symbol.iterator](){return this.entries()}find(t,e={}){for(const s of this.#I()){const i=this.#L[s],r=this.#B(i)?i.__staleWhileFetching:i;if(void 0!==r&&t(r,this.#E[s],this))return this.get(this.#E[s],e)}}forEach(t,e=this){for(const s of this.#I()){const i=this.#L[s],r=this.#B(i)?i.__staleWhileFetching:i;void 0!==r&&t.call(e,r,this.#E[s],this)}}rforEach(t,e=this){for(const s of this.#$()){const i=this.#L[s],r=this.#B(i)?i.__staleWhileFetching:i;void 0!==r&&t.call(e,r,this.#E[s],this)}}purgeStale(){let t=!1;for(const e of this.#$({allowStale:!0}))this.#U(e)&&(this.delete(this.#E[e]),t=!0);return t}info(t){const e=this.#x.get(t);if(void 0===e)return;const s=this.#L[e],i=this.#B(s)?s.__staleWhileFetching:s;if(void 0===i)return;const r={value:i};if(this.#N&&this.#R){const t=this.#N[e],s=this.#R[e];if(t&&s){const e=t-(At.now()-s);r.ttl=e,r.start=Date.now()}}return this.#M&&(r.size=this.#M[e]),r}dump(){const t=[];for(const e of this.#I({allowStale:!0})){const s=this.#E[e],i=this.#L[e],r=this.#B(i)?i.__staleWhileFetching:i;if(void 0===r||void 0===s)continue;const n={value:r};if(this.#N&&this.#R){n.ttl=this.#N[e];const t=At.now()-this.#R[e];n.start=Math.floor(Date.now()-t)}this.#M&&(n.size=this.#M[e]),t.unshift([s,n])}return t}load(t){this.clear();for(const[e,s]of t){if(s.start){const t=Date.now()-s.start;s.start=At.now()-t}this.set(e,s.value,s)}}set(t,e,s={}){if(void 0===e)return this.delete(t),this;const{ttl:i=this.ttl,start:r,noDisposeOnSet:n=this.noDisposeOnSet,sizeCalculation:h=this.sizeCalculation,status:o}=s;let{noUpdateTTL:a=this.noUpdateTTL}=s;const l=this.#K(t,e,s.size||0,h);if(this.maxEntrySize&&l>this.maxEntrySize)return o&&(o.set="miss",o.maxEntrySizeExceeded=!0),this.delete(t),this;let c=0===this.#S?void 0:this.#x.get(t);if(void 0===c)c=0===this.#S?this.#C:0!==this.#O.length?this.#O.pop():this.#S===this.#m?this.#X(!1):this.#S,this.#E[c]=t,this.#L[c]=e,this.#x.set(t,c),this.#T[this.#C]=c,this.#A[c]=this.#C,this.#C=c,this.#S++,this.#Y(c,l,o),o&&(o.set="add"),a=!1;else{this.#W(c);const s=this.#L[c];if(e!==s){if(this.#D&&this.#B(s)){s.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:e}=s;void 0===e||n||(this.#P&&this.#y?.(e,t,"set"),this.#_&&this.#z?.push([e,t,"set"]))}else n||(this.#P&&this.#y?.(s,t,"set"),this.#_&&this.#z?.push([s,t,"set"]));if(this.#J(c),this.#Y(c,l,o),this.#L[c]=e,o){o.set="replace";const t=s&&this.#B(s)?s.__staleWhileFetching:s;void 0!==t&&(o.oldValue=t)}}else o&&(o.set="update")}if(0===i||this.#N||this.#H(),this.#N&&(a||this.#q(c,i,r),o&&this.#Z(o,c)),!n&&this.#_&&this.#z){const t=this.#z;let e;for(;e=t?.shift();)this.#b?.(...e)}return this}pop(){try{for(;this.#S;){const t=this.#L[this.#F];if(this.#X(!0),this.#B(t)){if(t.__staleWhileFetching)return t.__staleWhileFetching}else if(void 0!==t)return t}}finally{if(this.#_&&this.#z){const t=this.#z;let e;for(;e=t?.shift();)this.#b?.(...e)}}}#X(t){const e=this.#F,s=this.#E[e],i=this.#L[e];return this.#D&&this.#B(i)?i.__abortController.abort(new Error("evicted")):(this.#P||this.#_)&&(this.#P&&this.#y?.(i,s,"evict"),this.#_&&this.#z?.push([i,s,"evict"])),this.#J(e),t&&(this.#E[e]=void 0,this.#L[e]=void 0,this.#O.push(e)),1===this.#S?(this.#F=this.#C=0,this.#O.length=0):this.#F=this.#T[e],this.#x.delete(s),this.#S--,e}has(t,e={}){const{updateAgeOnHas:s=this.updateAgeOnHas,status:i}=e,r=this.#x.get(t);if(void 0!==r){const t=this.#L[r];if(this.#B(t)&&void 0===t.__staleWhileFetching)return!1;if(!this.#U(r))return s&&this.#V(r),i&&(i.has="hit",this.#Z(i,r)),!0;i&&(i.has="stale",this.#Z(i,r))}else i&&(i.has="miss");return!1}peek(t,e={}){const{allowStale:s=this.allowStale}=e,i=this.#x.get(t);if(void 0===i||!s&&this.#U(i))return;const r=this.#L[i];return this.#B(r)?r.__staleWhileFetching:r}#j(t,e,s,i){const r=void 0===e?void 0:this.#L[e];if(this.#B(r))return r;const n=new zt,{signal:h}=s;h?.addEventListener("abort",(()=>n.abort(h.reason)),{signal:n.signal});const o={signal:n.signal,options:s,context:i},a=(i,r=!1)=>{const{aborted:h}=n.signal,a=s.ignoreFetchAbort&&void 0!==i;if(s.status&&(h&&!r?(s.status.fetchAborted=!0,s.status.fetchError=n.signal.reason,a&&(s.status.fetchAbortIgnored=!0)):s.status.fetchResolved=!0),h&&!a&&!r)return l(n.signal.reason);const p=c;return this.#L[e]===c&&(void 0===i?p.__staleWhileFetching?this.#L[e]=p.__staleWhileFetching:this.delete(t):(s.status&&(s.status.fetchUpdated=!0),this.set(t,i,o.options))),i},l=i=>{const{aborted:r}=n.signal,h=r&&s.allowStaleOnFetchAbort,o=h||s.allowStaleOnFetchRejection,a=o||s.noDeleteOnFetchRejection,l=c;if(this.#L[e]===c){!a||void 0===l.__staleWhileFetching?this.delete(t):h||(this.#L[e]=l.__staleWhileFetching)}if(o)return s.status&&void 0!==l.__staleWhileFetching&&(s.status.returnedStale=!0),l.__staleWhileFetching;if(l.__returned===l)throw i};s.status&&(s.status.fetchDispatched=!0);const c=new Promise(((e,i)=>{const h=this.#v?.(t,r,o);h&&h instanceof Promise&&h.then((t=>e(void 0===t?void 0:t)),i),n.signal.addEventListener("abort",(()=>{s.ignoreFetchAbort&&!s.allowStaleOnFetchAbort||(e(void 0),s.allowStaleOnFetchAbort&&(e=t=>a(t,!0)))}))})).then(a,(t=>(s.status&&(s.status.fetchRejected=!0,s.status.fetchError=t),l(t)))),p=Object.assign(c,{__abortController:n,__staleWhileFetching:r,__returned:void 0});return void 0===e?(this.set(t,p,{...o.options,status:void 0}),e=this.#x.get(t)):this.#L[e]=p,p}#B(t){if(!this.#D)return!1;const e=t;return!!e&&e instanceof Promise&&e.hasOwnProperty("__staleWhileFetching")&&e.__abortController instanceof zt}async fetch(t,e={}){const{allowStale:s=this.allowStale,updateAgeOnGet:i=this.updateAgeOnGet,noDeleteOnStaleGet:r=this.noDeleteOnStaleGet,ttl:n=this.ttl,noDisposeOnSet:h=this.noDisposeOnSet,size:o=0,sizeCalculation:a=this.sizeCalculation,noUpdateTTL:l=this.noUpdateTTL,noDeleteOnFetchRejection:c=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:p=this.allowStaleOnFetchRejection,ignoreFetchAbort:d=this.ignoreFetchAbort,allowStaleOnFetchAbort:u=this.allowStaleOnFetchAbort,context:f,forceRefresh:g=!1,status:m,signal:w}=e;if(!this.#D)return m&&(m.fetch="get"),this.get(t,{allowStale:s,updateAgeOnGet:i,noDeleteOnStaleGet:r,status:m});const y={allowStale:s,updateAgeOnGet:i,noDeleteOnStaleGet:r,ttl:n,noDisposeOnSet:h,size:o,sizeCalculation:a,noUpdateTTL:l,noDeleteOnFetchRejection:c,allowStaleOnFetchRejection:p,allowStaleOnFetchAbort:u,ignoreFetchAbort:d,status:m,signal:w};let b=this.#x.get(t);if(void 0===b){m&&(m.fetch="miss");const e=this.#j(t,b,y,f);return e.__returned=e}{const e=this.#L[b];if(this.#B(e)){const t=s&&void 0!==e.__staleWhileFetching;return m&&(m.fetch="inflight",t&&(m.returnedStale=!0)),t?e.__staleWhileFetching:e.__returned=e}const r=this.#U(b);if(!g&&!r)return m&&(m.fetch="hit"),this.#W(b),i&&this.#V(b),m&&this.#Z(m,b),e;const n=this.#j(t,b,y,f),h=void 0!==n.__staleWhileFetching&&s;return m&&(m.fetch=r?"stale":"refresh",h&&r&&(m.returnedStale=!0)),h?n.__staleWhileFetching:n.__returned=n}}get(t,e={}){const{allowStale:s=this.allowStale,updateAgeOnGet:i=this.updateAgeOnGet,noDeleteOnStaleGet:r=this.noDeleteOnStaleGet,status:n}=e,h=this.#x.get(t);if(void 0!==h){const e=this.#L[h],o=this.#B(e);return n&&this.#Z(n,h),this.#U(h)?(n&&(n.get="stale"),o?(n&&s&&void 0!==e.__staleWhileFetching&&(n.returnedStale=!0),s?e.__staleWhileFetching:void 0):(r||this.delete(t),n&&s&&(n.returnedStale=!0),s?e:void 0)):(n&&(n.get="hit"),o?e.__staleWhileFetching:(this.#W(h),i&&this.#V(h),e))}n&&(n.get="miss")}#tt(t,e){this.#A[e]=t,this.#T[t]=e}#W(t){t!==this.#C&&(t===this.#F?this.#F=this.#T[t]:this.#tt(this.#A[t],this.#T[t]),this.#tt(this.#C,t),this.#C=t)}delete(t){let e=!1;if(0!==this.#S){const s=this.#x.get(t);if(void 0!==s)if(e=!0,1===this.#S)this.clear();else{this.#J(s);const e=this.#L[s];if(this.#B(e)?e.__abortController.abort(new Error("deleted")):(this.#P||this.#_)&&(this.#P&&this.#y?.(e,t,"delete"),this.#_&&this.#z?.push([e,t,"delete"])),this.#x.delete(t),this.#E[s]=void 0,this.#L[s]=void 0,s===this.#C)this.#C=this.#A[s];else if(s===this.#F)this.#F=this.#T[s];else{const t=this.#A[s];this.#T[t]=this.#T[s];const e=this.#T[s];this.#A[e]=this.#A[s]}this.#S--,this.#O.push(s)}}if(this.#_&&this.#z?.length){const t=this.#z;let e;for(;e=t?.shift();)this.#b?.(...e)}return e}clear(){for(const t of this.#$({allowStale:!0})){const e=this.#L[t];if(this.#B(e))e.__abortController.abort(new Error("deleted"));else{const s=this.#E[t];this.#P&&this.#y?.(e,s,"delete"),this.#_&&this.#z?.push([e,s,"delete"])}}if(this.#x.clear(),this.#L.fill(void 0),this.#E.fill(void 0),this.#N&&this.#R&&(this.#N.fill(0),this.#R.fill(0)),this.#M&&this.#M.fill(0),this.#F=0,this.#C=0,this.#O.length=0,this.#k=0,this.#S=0,this.#_&&this.#z){const t=this.#z;let e;for(;e=t?.shift();)this.#b?.(...e)}}}const Bt="object"==typeof process&&process?process:{stdout:null,stderr:null},jt=t=>!!t&&"object"==typeof t&&(t instanceof xe||t instanceof g||Wt(t)||It(t)),Wt=t=>!!t&&"object"==typeof t&&t instanceof f&&"function"==typeof t.pipe&&t.pipe!==g.Writable.prototype.pipe,It=t=>!!t&&"object"==typeof t&&t instanceof f&&"function"==typeof t.write&&"function"==typeof t.end,$t=Symbol("EOF"),Ut=Symbol("maybeEmitEnd"),Gt=Symbol("emittedEnd"),Ht=Symbol("emittingEnd"),qt=Symbol("emittedError"),Vt=Symbol("closed"),Zt=Symbol("read"),Jt=Symbol("flush"),Kt=Symbol("flushChunk"),Yt=Symbol("encoding"),Xt=Symbol("decoder"),Qt=Symbol("flowing"),te=Symbol("paused"),ee=Symbol("resume"),se=Symbol("buffer"),ie=Symbol("pipes"),re=Symbol("bufferLength"),ne=Symbol("bufferPush"),he=Symbol("bufferShift"),oe=Symbol("objectMode"),ae=Symbol("destroyed"),le=Symbol("error"),ce=Symbol("emitData"),pe=Symbol("emitEnd"),de=Symbol("emitEnd2"),ue=Symbol("async"),fe=Symbol("abort"),ge=Symbol("aborted"),me=Symbol("signal"),we=Symbol("dataListeners"),ye=Symbol("discarded"),be=t=>Promise.resolve().then(t),ve=t=>t();class Se{src;dest;opts;ondrain;constructor(t,e,s){this.src=t,this.dest=e,this.opts=s,this.ondrain=()=>t[ee](),this.dest.on("drain",this.ondrain)}unpipe(){this.dest.removeListener("drain",this.ondrain)}proxyErrors(t){}end(){this.unpipe(),this.opts.end&&this.dest.end()}}class ke extends Se{unpipe(){this.src.removeListener("error",this.proxyErrors),super.unpipe()}constructor(t,e,s){super(t,e,s),this.proxyErrors=t=>e.emit("error",t),t.on("error",this.proxyErrors)}}class xe extends f{[Qt]=!1;[te]=!1;[ie]=[];[se]=[];[oe];[Yt];[ue];[Xt];[$t]=!1;[Gt]=!1;[Ht]=!1;[Vt]=!1;[qt]=null;[re]=0;[ae]=!1;[me];[ge]=!1;[we]=0;[ye]=!1;writable=!0;readable=!0;constructor(...t){const e=t[0]||{};if(super(),e.objectMode&&"string"==typeof e.encoding)throw new TypeError("Encoding and objectMode may not be used together");e.objectMode?(this[oe]=!0,this[Yt]=null):(t=>!t.objectMode&&!!t.encoding&&"buffer"!==t.encoding)(e)?(this[Yt]=e.encoding,this[oe]=!1):(this[oe]=!1,this[Yt]=null),this[ue]=!!e.async,this[Xt]=this[Yt]?new m(this[Yt]):null,e&&!0===e.debugExposeBuffer&&Object.defineProperty(this,"buffer",{get:()=>this[se]}),e&&!0===e.debugExposePipes&&Object.defineProperty(this,"pipes",{get:()=>this[ie]});const{signal:s}=e;s&&(this[me]=s,s.aborted?this[fe]():s.addEventListener("abort",(()=>this[fe]())))}get bufferLength(){return this[re]}get encoding(){return this[Yt]}set encoding(t){throw new Error("Encoding must be set at instantiation time")}setEncoding(t){throw new Error("Encoding must be set at instantiation time")}get objectMode(){return this[oe]}set objectMode(t){throw new Error("objectMode must be set at instantiation time")}get async(){return this[ue]}set async(t){this[ue]=this[ue]||!!t}[fe](){this[ge]=!0,this.emit("abort",this[me]?.reason),this.destroy(this[me]?.reason)}get aborted(){return this[ge]}set aborted(t){}write(t,e,s){if(this[ge])return!1;if(this[$t])throw new Error("write after end");if(this[ae])return this.emit("error",Object.assign(new Error("Cannot call write after a stream was destroyed"),{code:"ERR_STREAM_DESTROYED"})),!0;"function"==typeof e&&(s=e,e="utf8"),e||(e="utf8");const i=this[ue]?be:ve;if(!this[oe]&&!Buffer.isBuffer(t))if(r=t,!Buffer.isBuffer(r)&&ArrayBuffer.isView(r))t=Buffer.from(t.buffer,t.byteOffset,t.byteLength);else if((t=>t instanceof ArrayBuffer||!!t&&"object"==typeof t&&t.constructor&&"ArrayBuffer"===t.constructor.name&&t.byteLength>=0)(t))t=Buffer.from(t);else if("string"!=typeof t)throw new Error("Non-contiguous data written to non-objectMode stream");var r;return this[oe]?(this[Qt]&&0!==this[re]&&this[Jt](!0),this[Qt]?this.emit("data",t):this[ne](t),0!==this[re]&&this.emit("readable"),s&&i(s),this[Qt]):t.length?("string"!=typeof t||e===this[Yt]&&!this[Xt]?.lastNeed||(t=Buffer.from(t,e)),Buffer.isBuffer(t)&&this[Yt]&&(t=this[Xt].write(t)),this[Qt]&&0!==this[re]&&this[Jt](!0),this[Qt]?this.emit("data",t):this[ne](t),0!==this[re]&&this.emit("readable"),s&&i(s),this[Qt]):(0!==this[re]&&this.emit("readable"),s&&i(s),this[Qt])}read(t){if(this[ae])return null;if(this[ye]=!1,0===this[re]||0===t||t&&t>this[re])return this[Ut](),null;this[oe]&&(t=null),this[se].length>1&&!this[oe]&&(this[se]=[this[Yt]?this[se].join(""):Buffer.concat(this[se],this[re])]);const e=this[Zt](t||null,this[se][0]);return this[Ut](),e}[Zt](t,e){if(this[oe])this[he]();else{const s=e;t===s.length||null===t?this[he]():"string"==typeof s?(this[se][0]=s.slice(t),e=s.slice(0,t),this[re]-=t):(this[se][0]=s.subarray(t),e=s.subarray(0,t),this[re]-=t)}return this.emit("data",e),this[se].length||this[$t]||this.emit("drain"),e}end(t,e,s){return"function"==typeof t&&(s=t,t=void 0),"function"==typeof e&&(s=e,e="utf8"),void 0!==t&&this.write(t,e),s&&this.once("end",s),this[$t]=!0,this.writable=!1,!this[Qt]&&this[te]||this[Ut](),this}[ee](){this[ae]||(this[we]||this[ie].length||(this[ye]=!0),this[te]=!1,this[Qt]=!0,this.emit("resume"),this[se].length?this[Jt]():this[$t]?this[Ut]():this.emit("drain"))}resume(){return this[ee]()}pause(){this[Qt]=!1,this[te]=!0,this[ye]=!1}get destroyed(){return this[ae]}get flowing(){return this[Qt]}get paused(){return this[te]}[ne](t){this[oe]?this[re]+=1:this[re]+=t.length,this[se].push(t)}[he](){return this[oe]?this[re]-=1:this[re]-=this[se][0].length,this[se].shift()}[Jt](t=!1){do{}while(this[Kt](this[he]())&&this[se].length);t||this[se].length||this[$t]||this.emit("drain")}[Kt](t){return this.emit("data",t),this[Qt]}pipe(t,e){if(this[ae])return t;this[ye]=!1;const s=this[Gt];return e=e||{},t===Bt.stdout||t===Bt.stderr?e.end=!1:e.end=!1!==e.end,e.proxyErrors=!!e.proxyErrors,s?e.end&&t.end():(this[ie].push(e.proxyErrors?new ke(this,t,e):new Se(this,t,e)),this[ue]?be((()=>this[ee]())):this[ee]()),t}unpipe(t){const e=this[ie].find((e=>e.dest===t));e&&(1===this[ie].length?(this[Qt]&&0===this[we]&&(this[Qt]=!1),this[ie]=[]):this[ie].splice(this[ie].indexOf(e),1),e.unpipe())}addListener(t,e){return this.on(t,e)}on(t,e){const s=super.on(t,e);if("data"===t)this[ye]=!1,this[we]++,this[ie].length||this[Qt]||this[ee]();else if("readable"===t&&0!==this[re])super.emit("readable");else if((t=>"end"===t||"finish"===t||"prefinish"===t)(t)&&this[Gt])super.emit(t),this.removeAllListeners(t);else if("error"===t&&this[qt]){const t=e;this[ue]?be((()=>t.call(this,this[qt]))):t.call(this,this[qt])}return s}removeListener(t,e){return this.off(t,e)}off(t,e){const s=super.off(t,e);return"data"===t&&(this[we]=this.listeners("data").length,0!==this[we]||this[ye]||this[ie].length||(this[Qt]=!1)),s}removeAllListeners(t){const e=super.removeAllListeners(t);return"data"!==t&&void 0!==t||(this[we]=0,this[ye]||this[ie].length||(this[Qt]=!1)),e}get emittedEnd(){return this[Gt]}[Ut](){this[Ht]||this[Gt]||this[ae]||0!==this[se].length||!this[$t]||(this[Ht]=!0,this.emit("end"),this.emit("prefinish"),this.emit("finish"),this[Vt]&&this.emit("close"),this[Ht]=!1)}emit(t,...e){const s=e[0];if("error"!==t&&"close"!==t&&t!==ae&&this[ae])return!1;if("data"===t)return!(!this[oe]&&!s)&&(this[ue]?(be((()=>this[ce](s))),!0):this[ce](s));if("end"===t)return this[pe]();if("close"===t){if(this[Vt]=!0,!this[Gt]&&!this[ae])return!1;const t=super.emit("close");return this.removeAllListeners("close"),t}if("error"===t){this[qt]=s,super.emit(le,s);const t=!(this[me]&&!this.listeners("error").length)&&super.emit("error",s);return this[Ut](),t}if("resume"===t){const t=super.emit("resume");return this[Ut](),t}if("finish"===t||"prefinish"===t){const e=super.emit(t);return this.removeAllListeners(t),e}const i=super.emit(t,...e);return this[Ut](),i}[ce](t){for(const e of this[ie])!1===e.dest.write(t)&&this.pause();const e=!this[ye]&&super.emit("data",t);return this[Ut](),e}[pe](){return!this[Gt]&&(this[Gt]=!0,this.readable=!1,this[ue]?(be((()=>this[de]())),!0):this[de]())}[de](){if(this[Xt]){const t=this[Xt].end();if(t){for(const e of this[ie])e.dest.write(t);this[ye]||super.emit("data",t)}}for(const t of this[ie])t.end();const t=super.emit("end");return this.removeAllListeners("end"),t}async collect(){const t=Object.assign([],{dataLength:0});this[oe]||(t.dataLength=0);const e=this.promise();return this.on("data",(e=>{t.push(e),this[oe]||(t.dataLength+=e.length)})),await e,t}async concat(){if(this[oe])throw new Error("cannot concat in objectMode");const t=await this.collect();return this[Yt]?t.join(""):Buffer.concat(t,t.dataLength)}async promise(){return new Promise(((t,e)=>{this.on(ae,(()=>e(new Error("stream destroyed")))),this.on("error",(t=>e(t))),this.on("end",(()=>t()))}))}[Symbol.asyncIterator](){this[ye]=!1;let t=!1;const e=async()=>(this.pause(),t=!0,{value:void 0,done:!0});return{next:()=>{if(t)return e();const s=this.read();if(null!==s)return Promise.resolve({done:!1,value:s});if(this[$t])return e();let i,r;const n=t=>{this.off("data",h),this.off("end",o),this.off(ae,a),e(),r(t)},h=t=>{this.off("error",n),this.off("end",o),this.off(ae,a),this.pause(),i({value:t,done:!!this[$t]})},o=()=>{this.off("error",n),this.off("data",h),this.off(ae,a),e(),i({done:!0,value:void 0})},a=()=>n(new Error("stream destroyed"));return new Promise(((t,e)=>{r=e,i=t,this.once(ae,a),this.once("error",n),this.once("end",o),this.once("data",h)}))},throw:e,return:e,[Symbol.asyncIterator](){return this}}}[Symbol.iterator](){this[ye]=!1;let t=!1;const e=()=>(this.pause(),this.off(le,e),this.off(ae,e),this.off("end",e),t=!0,{done:!0,value:void 0});return this.once("end",e),this.once(le,e),this.once(ae,e),{next:()=>{if(t)return e();const s=this.read();return null===s?e():{done:!1,value:s}},throw:e,return:e,[Symbol.iterator](){return this}}}destroy(t){if(this[ae])return t?this.emit("error",t):this.emit(ae),this;this[ae]=!0,this[ye]=!0,this[se].length=0,this[re]=0;return"function"!=typeof this.close||this[Vt]||this.close(),t?this.emit("error",t):this.emit(ae),this}static get isStream(){return jt}}const Ee={lstatSync:h,readdir:o,readdirSync:a,readlinkSync:l,realpathSync:n.native,promises:{lstat:c,readdir:p,readlink:d,realpath:u}},Le=t=>t&&t!==Ee&&t!==r?{...Ee,...t,promises:{...Ee.promises,...t.promises||{}}}:Ee,Te=/^\\\\\?\\([a-z]:)\\?$/i,Ae=/[\\\/]/,Fe=10,Ce=15,Oe=-16,ze=128,Me=256,Re=512,Ne=t=>t.isFile()?8:t.isDirectory()?4:t.isSymbolicLink()?Fe:t.isCharacterDevice()?2:t.isBlockDevice()?6:t.isSocket()?12:t.isFIFO()?1:0,Pe=new Map,De=t=>{const e=Pe.get(t);if(e)return e;const s=t.normalize("NFKD");return Pe.set(t,s),s},_e=new Map,Be=t=>{const e=_e.get(t);if(e)return e;const s=De(t.toLowerCase());return _e.set(t,s),s};class je extends _t{constructor(){super({max:256})}}class We extends _t{constructor(t=16384){super({maxSize:t,sizeCalculation:t=>t.length+1})}}const Ie=Symbol("PathScurry setAsCwd");class $e{name;root;roots;parent;nocase;#et;#st;get dev(){return this.#st}#it;get mode(){return this.#it}#rt;get nlink(){return this.#rt}#nt;get uid(){return this.#nt}#ht;get gid(){return this.#ht}#ot;get rdev(){return this.#ot}#at;get blksize(){return this.#at}#lt;get ino(){return this.#lt}#S;get size(){return this.#S}#ct;get blocks(){return this.#ct}#pt;get atimeMs(){return this.#pt}#dt;get mtimeMs(){return this.#dt}#ut;get ctimeMs(){return this.#ut}#ft;get birthtimeMs(){return this.#ft}#gt;get atime(){return this.#gt}#mt;get mtime(){return this.#mt}#wt;get ctime(){return this.#wt}#yt;get birthtime(){return this.#yt}#bt;#vt;#St;#kt;#xt;#Et;#Lt;#Tt;#At;#Ft;get path(){return(this.parent||this).fullpath()}constructor(t,e=0,s,i,r,n,h){this.name=t,this.#bt=r?Be(t):De(t),this.#Lt=1023&e,this.nocase=r,this.roots=i,this.root=s||this,this.#Tt=n,this.#St=h.fullpath,this.#xt=h.relative,this.#Et=h.relativePosix,this.parent=h.parent,this.parent?this.#et=this.parent.#et:this.#et=Le(h.fs)}depth(){return void 0!==this.#vt?this.#vt:this.parent?this.#vt=this.parent.depth()+1:this.#vt=0}childrenCache(){return this.#Tt}resolve(t){if(!t)return this;const e=this.getRootString(t),s=t.substring(e.length).split(this.splitSep);return e?this.getRoot(e).#Ct(s):this.#Ct(s)}#Ct(t){let e=this;for(const s of t)e=e.child(s);return e}children(){const t=this.#Tt.get(this);if(t)return t;const e=Object.assign([],{provisional:0});return this.#Tt.set(this,e),this.#Lt&=-17,e}child(t,e){if(""===t||"."===t)return this;if(".."===t)return this.parent||this;const s=this.children(),i=this.nocase?Be(t):De(t);for(const t of s)if(t.#bt===i)return t;const r=this.parent?this.sep:"",n=this.#St?this.#St+r+t:void 0,h=this.newChild(t,0,{...e,parent:this,fullpath:n});return this.canReaddir()||(h.#Lt|=ze),s.push(h),h}relative(){if(void 0!==this.#xt)return this.#xt;const t=this.name,e=this.parent;if(!e)return this.#xt=this.name;const s=e.relative();return s+(s&&e.parent?this.sep:"")+t}relativePosix(){if("/"===this.sep)return this.relative();if(void 0!==this.#Et)return this.#Et;const t=this.name,e=this.parent;if(!e)return this.#Et=this.fullpathPosix();const s=e.relativePosix();return s+(s&&e.parent?"/":"")+t}fullpath(){if(void 0!==this.#St)return this.#St;const t=this.name,e=this.parent;if(!e)return this.#St=this.name;const s=e.fullpath()+(e.parent?this.sep:"")+t;return this.#St=s}fullpathPosix(){if(void 0!==this.#kt)return this.#kt;if("/"===this.sep)return this.#kt=this.fullpath();if(!this.parent){const t=this.fullpath().replace(/\\/g,"/");return/^[a-z]:\//i.test(t)?this.#kt=`//?/${t}`:this.#kt=t}const t=this.parent,e=t.fullpathPosix(),s=e+(e&&t.parent?"/":"")+this.name;return this.#kt=s}isUnknown(){return 0==(this.#Lt&Ce)}isType(t){return this[`is${t}`]()}getType(){return this.isUnknown()?"Unknown":this.isDirectory()?"Directory":this.isFile()?"File":this.isSymbolicLink()?"SymbolicLink":this.isFIFO()?"FIFO":this.isCharacterDevice()?"CharacterDevice":this.isBlockDevice()?"BlockDevice":this.isSocket()?"Socket":"Unknown"}isFile(){return 8==(this.#Lt&Ce)}isDirectory(){return 4==(this.#Lt&Ce)}isCharacterDevice(){return 2==(this.#Lt&Ce)}isBlockDevice(){return 6==(this.#Lt&Ce)}isFIFO(){return 1==(this.#Lt&Ce)}isSocket(){return 12==(this.#Lt&Ce)}isSymbolicLink(){return(this.#Lt&Fe)===Fe}lstatCached(){return 32&this.#Lt?this:void 0}readlinkCached(){return this.#At}realpathCached(){return this.#Ft}readdirCached(){const t=this.children();return t.slice(0,t.provisional)}canReadlink(){if(this.#At)return!0;if(!this.parent)return!1;const t=this.#Lt&Ce;return!(0!==t&&t!==Fe||this.#Lt&Me||this.#Lt&ze)}calledReaddir(){return!!(16&this.#Lt)}isENOENT(){return!!(this.#Lt&ze)}isNamed(t){return this.nocase?this.#bt===Be(t):this.#bt===De(t)}async readlink(){const t=this.#At;if(t)return t;if(this.canReadlink()&&this.parent)try{const t=await this.#et.promises.readlink(this.fullpath()),e=this.parent.resolve(t);if(e)return this.#At=e}catch(t){return void this.#Ot(t.code)}}readlinkSync(){const t=this.#At;if(t)return t;if(this.canReadlink()&&this.parent)try{const t=this.#et.readlinkSync(this.fullpath()),e=this.parent.resolve(t);if(e)return this.#At=e}catch(t){return void this.#Ot(t.code)}}#zt(t){this.#Lt|=16;for(let e=t.provisional;e<t.length;e++)t[e].#Mt()}#Mt(){this.#Lt&ze||(this.#Lt=(this.#Lt|ze)&Oe,this.#Rt())}#Rt(){const t=this.children();t.provisional=0;for(const e of t)e.#Mt()}#Nt(){this.#Lt|=Re,this.#Pt()}#Pt(){if(64&this.#Lt)return;let t=this.#Lt;4==(t&Ce)&&(t&=Oe),this.#Lt=64|t,this.#Rt()}#Dt(t=""){"ENOTDIR"===t||"EPERM"===t?this.#Pt():"ENOENT"===t?this.#Mt():this.children().provisional=0}#_t(t=""){if("ENOTDIR"===t){this.parent.#Pt()}else"ENOENT"===t&&this.#Mt()}#Ot(t=""){let e=this.#Lt;e|=Me,"ENOENT"===t&&(e|=ze),"EINVAL"!==t&&"UNKNOWN"!==t||(e&=Oe),this.#Lt=e,"ENOTDIR"===t&&this.parent&&this.parent.#Pt()}#Bt(t,e){return this.#jt(t,e)||this.#Wt(t,e)}#Wt(t,e){const s=Ne(t),i=this.newChild(t.name,s,{parent:this}),r=i.#Lt&Ce;return 4!==r&&r!==Fe&&0!==r&&(i.#Lt|=64),e.unshift(i),e.provisional++,i}#jt(t,e){for(let s=e.provisional;s<e.length;s++){const i=e[s];if((this.nocase?Be(t.name):De(t.name))===i.#bt)return this.#It(t,i,s,e)}}#It(t,e,s,i){const r=e.name;return e.#Lt=e.#Lt&Oe|Ne(t),r!==t.name&&(e.name=t.name),s!==i.provisional&&(s===i.length-1?i.pop():i.splice(s,1),i.unshift(e)),i.provisional++,e}async lstat(){if(0==(this.#Lt&ze))try{return this.#$t(await this.#et.promises.lstat(this.fullpath())),this}catch(t){this.#_t(t.code)}}lstatSync(){if(0==(this.#Lt&ze))try{return this.#$t(this.#et.lstatSync(this.fullpath())),this}catch(t){this.#_t(t.code)}}#$t(t){const{atime:e,atimeMs:s,birthtime:i,birthtimeMs:r,blksize:n,blocks:h,ctime:o,ctimeMs:a,dev:l,gid:c,ino:p,mode:d,mtime:u,mtimeMs:f,nlink:g,rdev:m,size:w,uid:y}=t;this.#gt=e,this.#pt=s,this.#yt=i,this.#ft=r,this.#at=n,this.#ct=h,this.#wt=o,this.#ut=a,this.#st=l,this.#ht=c,this.#lt=p,this.#it=d,this.#mt=u,this.#dt=f,this.#rt=g,this.#ot=m,this.#S=w,this.#nt=y;const b=Ne(t);this.#Lt=this.#Lt&Oe|b|32,0!==b&&4!==b&&b!==Fe&&(this.#Lt|=64)}#Ut=[];#Gt=!1;#Ht(t){this.#Gt=!1;const e=this.#Ut.slice();this.#Ut.length=0,e.forEach((e=>e(null,t)))}readdirCB(t,e=!1){if(!this.canReaddir())return void(e?t(null,[]):queueMicrotask((()=>t(null,[]))));const s=this.children();if(this.calledReaddir()){const i=s.slice(0,s.provisional);return void(e?t(null,i):queueMicrotask((()=>t(null,i))))}if(this.#Ut.push(t),this.#Gt)return;this.#Gt=!0;const i=this.fullpath();this.#et.readdir(i,{withFileTypes:!0},((t,e)=>{if(t)this.#Dt(t.code),s.provisional=0;else{for(const t of e)this.#Bt(t,s);this.#zt(s)}this.#Ht(s.slice(0,s.provisional))}))}#qt;async readdir(){if(!this.canReaddir())return[];const t=this.children();if(this.calledReaddir())return t.slice(0,t.provisional);const e=this.fullpath();if(this.#qt)await this.#qt;else{let s=()=>{};this.#qt=new Promise((t=>s=t));try{for(const s of await this.#et.promises.readdir(e,{withFileTypes:!0}))this.#Bt(s,t);this.#zt(t)}catch(e){this.#Dt(e.code),t.provisional=0}this.#qt=void 0,s()}return t.slice(0,t.provisional)}readdirSync(){if(!this.canReaddir())return[];const t=this.children();if(this.calledReaddir())return t.slice(0,t.provisional);const e=this.fullpath();try{for(const s of this.#et.readdirSync(e,{withFileTypes:!0}))this.#Bt(s,t);this.#zt(t)}catch(e){this.#Dt(e.code),t.provisional=0}return t.slice(0,t.provisional)}canReaddir(){if(704&this.#Lt)return!1;const t=Ce&this.#Lt;return 0===t||4===t||t===Fe}shouldWalk(t,e){return 4==(4&this.#Lt)&&!(704&this.#Lt)&&!t.has(this)&&(!e||e(this))}async realpath(){if(this.#Ft)return this.#Ft;if(!(896&this.#Lt))try{const t=await this.#et.promises.realpath(this.fullpath());return this.#Ft=this.resolve(t)}catch(t){this.#Nt()}}realpathSync(){if(this.#Ft)return this.#Ft;if(!(896&this.#Lt))try{const t=this.#et.realpathSync(this.fullpath());return this.#Ft=this.resolve(t)}catch(t){this.#Nt()}}[Ie](t){if(t===this)return;const e=new Set([]);let s=[],i=this;for(;i&&i.parent;)e.add(i),i.#xt=s.join(this.sep),i.#Et=s.join("/"),i=i.parent,s.push("..");for(i=t;i&&i.parent&&!e.has(i);)i.#xt=void 0,i.#Et=void 0,i=i.parent}}class Ue extends $e{sep="\\";splitSep=Ae;constructor(t,e=0,s,i,r,n,h){super(t,e,s,i,r,n,h)}newChild(t,e=0,s={}){return new Ue(t,e,this.root,this.roots,this.nocase,this.childrenCache(),s)}getRootString(t){return e.parse(t).root}getRoot(t){if((t=(t=>t.replace(/\//g,"\\").replace(Te,"$1\\"))(t.toUpperCase()))===this.root.name)return this.root;for(const[e,s]of Object.entries(this.roots))if(this.sameRoot(t,e))return this.roots[t]=s;return this.roots[t]=new qe(t,this).root}sameRoot(t,e=this.root.name){return(t=t.toUpperCase().replace(/\//g,"\\").replace(Te,"$1\\"))===e}}class Ge extends $e{splitSep="/";sep="/";constructor(t,e=0,s,i,r,n,h){super(t,e,s,i,r,n,h)}getRootString(t){return t.startsWith("/")?"/":""}getRoot(t){return this.root}newChild(t,e=0,s={}){return new Ge(t,e,this.root,this.roots,this.nocase,this.childrenCache(),s)}}class He{root;rootPath;roots;cwd;#Vt;#Zt;#Tt;nocase;#et;constructor(t=process.cwd(),e,s,{nocase:r,childrenCacheSize:n=16384,fs:h=Ee}={}){this.#et=Le(h),(t instanceof URL||t.startsWith("file://"))&&(t=i(t));const o=e.resolve(t);this.roots=Object.create(null),this.rootPath=this.parseRootPath(o),this.#Vt=new je,this.#Zt=new je,this.#Tt=new We(n);const a=o.substring(this.rootPath.length).split(s);if(1!==a.length||a[0]||a.pop(),void 0===r)throw new TypeError("must provide nocase setting to PathScurryBase ctor");this.nocase=r,this.root=this.newRoot(this.#et),this.roots[this.rootPath]=this.root;let l=this.root,c=a.length-1;const p=e.sep;let d=this.rootPath,u=!1;for(const t of a){const e=c--;l=l.child(t,{relative:new Array(e).fill("..").join(p),relativePosix:new Array(e).fill("..").join("/"),fullpath:d+=(u?"":p)+t}),u=!0}this.cwd=l}depth(t=this.cwd){return"string"==typeof t&&(t=this.cwd.resolve(t)),t.depth()}childrenCache(){return this.#Tt}resolve(...t){let e="";for(let s=t.length-1;s>=0;s--){const i=t[s];if(i&&"."!==i&&(e=e?`${i}/${e}`:i,this.isAbsolute(i)))break}const s=this.#Vt.get(e);if(void 0!==s)return s;const i=this.cwd.resolve(e).fullpath();return this.#Vt.set(e,i),i}resolvePosix(...t){let e="";for(let s=t.length-1;s>=0;s--){const i=t[s];if(i&&"."!==i&&(e=e?`${i}/${e}`:i,this.isAbsolute(i)))break}const s=this.#Zt.get(e);if(void 0!==s)return s;const i=this.cwd.resolve(e).fullpathPosix();return this.#Zt.set(e,i),i}relative(t=this.cwd){return"string"==typeof t&&(t=this.cwd.resolve(t)),t.relative()}relativePosix(t=this.cwd){return"string"==typeof t&&(t=this.cwd.resolve(t)),t.relativePosix()}basename(t=this.cwd){return"string"==typeof t&&(t=this.cwd.resolve(t)),t.name}dirname(t=this.cwd){return"string"==typeof t&&(t=this.cwd.resolve(t)),(t.parent||t).fullpath()}async readdir(t=this.cwd,e={withFileTypes:!0}){"string"==typeof t?t=this.cwd.resolve(t):t instanceof $e||(e=t,t=this.cwd);const{withFileTypes:s}=e;if(t.canReaddir()){const e=await t.readdir();return s?e:e.map((t=>t.name))}return[]}readdirSync(t=this.cwd,e={withFileTypes:!0}){"string"==typeof t?t=this.cwd.resolve(t):t instanceof $e||(e=t,t=this.cwd);const{withFileTypes:s=!0}=e;return t.canReaddir()?s?t.readdirSync():t.readdirSync().map((t=>t.name)):[]}async lstat(t=this.cwd){return"string"==typeof t&&(t=this.cwd.resolve(t)),t.lstat()}lstatSync(t=this.cwd){return"string"==typeof t&&(t=this.cwd.resolve(t)),t.lstatSync()}async readlink(t=this.cwd,{withFileTypes:e}={withFileTypes:!1}){"string"==typeof t?t=this.cwd.resolve(t):t instanceof $e||(e=t.withFileTypes,t=this.cwd);const s=await t.readlink();return e?s:s?.fullpath()}readlinkSync(t=this.cwd,{withFileTypes:e}={withFileTypes:!1}){"string"==typeof t?t=this.cwd.resolve(t):t instanceof $e||(e=t.withFileTypes,t=this.cwd);const s=t.readlinkSync();return e?s:s?.fullpath()}async realpath(t=this.cwd,{withFileTypes:e}={withFileTypes:!1}){"string"==typeof t?t=this.cwd.resolve(t):t instanceof $e||(e=t.withFileTypes,t=this.cwd);const s=await t.realpath();return e?s:s?.fullpath()}realpathSync(t=this.cwd,{withFileTypes:e}={withFileTypes:!1}){"string"==typeof t?t=this.cwd.resolve(t):t instanceof $e||(e=t.withFileTypes,t=this.cwd);const s=t.realpathSync();return e?s:s?.fullpath()}async walk(t=this.cwd,e={}){"string"==typeof t?t=this.cwd.resolve(t):t instanceof $e||(e=t,t=this.cwd);const{withFileTypes:s=!0,follow:i=!1,filter:r,walkFilter:n}=e,h=[];r&&!r(t)||h.push(s?t:t.fullpath());const o=new Set,a=(t,e)=>{o.add(t),t.readdirCB(((t,l)=>{if(t)return e(t);let c=l.length;if(!c)return e();const p=()=>{0==--c&&e()};for(const t of l)r&&!r(t)||h.push(s?t:t.fullpath()),i&&t.isSymbolicLink()?t.realpath().then((t=>t?.isUnknown()?t.lstat():t)).then((t=>t?.shouldWalk(o,n)?a(t,p):p())):t.shouldWalk(o,n)?a(t,p):p()}),!0)},l=t;return new Promise(((t,e)=>{a(l,(s=>{if(s)return e(s);t(h)}))}))}walkSync(t=this.cwd,e={}){"string"==typeof t?t=this.cwd.resolve(t):t instanceof $e||(e=t,t=this.cwd);const{withFileTypes:s=!0,follow:i=!1,filter:r,walkFilter:n}=e,h=[];r&&!r(t)||h.push(s?t:t.fullpath());const o=new Set([t]);for(const t of o){const e=t.readdirSync();for(const t of e){r&&!r(t)||h.push(s?t:t.fullpath());let e=t;if(t.isSymbolicLink()){if(!i||!(e=t.realpathSync()))continue;e.isUnknown()&&e.lstatSync()}e.shouldWalk(o,n)&&o.add(e)}}return h}[Symbol.asyncIterator](){return this.iterate()}iterate(t=this.cwd,e={}){return"string"==typeof t?t=this.cwd.resolve(t):t instanceof $e||(e=t,t=this.cwd),this.stream(t,e)[Symbol.asyncIterator]()}[Symbol.iterator](){return this.iterateSync()}*iterateSync(t=this.cwd,e={}){"string"==typeof t?t=this.cwd.resolve(t):t instanceof $e||(e=t,t=this.cwd);const{withFileTypes:s=!0,follow:i=!1,filter:r,walkFilter:n}=e;r&&!r(t)||(yield s?t:t.fullpath());const h=new Set([t]);for(const t of h){const e=t.readdirSync();for(const t of e){r&&!r(t)||(yield s?t:t.fullpath());let e=t;if(t.isSymbolicLink()){if(!i||!(e=t.realpathSync()))continue;e.isUnknown()&&e.lstatSync()}e.shouldWalk(h,n)&&h.add(e)}}}stream(t=this.cwd,e={}){"string"==typeof t?t=this.cwd.resolve(t):t instanceof $e||(e=t,t=this.cwd);const{withFileTypes:s=!0,follow:i=!1,filter:r,walkFilter:n}=e,h=new xe({objectMode:!0});r&&!r(t)||h.write(s?t:t.fullpath());const o=new Set,a=[t];let l=0;const c=()=>{let t=!1;for(;!t;){const e=a.shift();if(!e)return void(0===l&&h.end());l++,o.add(e);const p=(e,u,f=!1)=>{if(e)return h.emit("error",e);if(i&&!f){const t=[];for(const e of u)e.isSymbolicLink()&&t.push(e.realpath().then((t=>t?.isUnknown()?t.lstat():t)));if(t.length)return void Promise.all(t).then((()=>p(null,u,!0)))}for(const e of u)!e||r&&!r(e)||h.write(s?e:e.fullpath())||(t=!0);l--;for(const t of u){const e=t.realpathCached()||t;e.shouldWalk(o,n)&&a.push(e)}t&&!h.flowing?h.once("drain",c):d||c()};let d=!0;e.readdirCB(p,!0),d=!1}};return c(),h}streamSync(t=this.cwd,e={}){"string"==typeof t?t=this.cwd.resolve(t):t instanceof $e||(e=t,t=this.cwd);const{withFileTypes:s=!0,follow:i=!1,filter:r,walkFilter:n}=e,h=new xe({objectMode:!0}),o=new Set;r&&!r(t)||h.write(s?t:t.fullpath());const a=[t];let l=0;const c=()=>{let t=!1;for(;!t;){const e=a.shift();if(!e)return void(0===l&&h.end());l++,o.add(e);const c=e.readdirSync();for(const e of c)r&&!r(e)||h.write(s?e:e.fullpath())||(t=!0);l--;for(const t of c){let e=t;if(t.isSymbolicLink()){if(!i||!(e=t.realpathSync()))continue;e.isUnknown()&&e.lstatSync()}e.shouldWalk(o,n)&&a.push(e)}}t&&!h.flowing&&h.once("drain",c)};return c(),h}chdir(t=this.cwd){const e=this.cwd;this.cwd="string"==typeof t?this.cwd.resolve(t):t,this.cwd[Ie](e)}}class qe extends He{sep="\\";constructor(t=process.cwd(),s={}){const{nocase:i=!0}=s;super(t,e,"\\",{...s,nocase:i}),this.nocase=i;for(let t=this.cwd;t;t=t.parent)t.nocase=this.nocase}parseRootPath(t){return e.parse(t).root.toUpperCase()}newRoot(t){return new Ue(this.rootPath,4,void 0,this.roots,this.nocase,this.childrenCache(),{fs:t})}isAbsolute(t){return t.startsWith("/")||t.startsWith("\\")||/^[a-z]:(\/|\\)/i.test(t)}}class Ve extends He{sep="/";constructor(t=process.cwd(),e={}){const{nocase:i=!1}=e;super(t,s,"/",{...e,nocase:i}),this.nocase=i}parseRootPath(t){return"/"}newRoot(t){return new Ge(this.rootPath,4,void 0,this.roots,this.nocase,this.childrenCache(),{fs:t})}isAbsolute(t){return t.startsWith("/")}}class Ze extends Ve{constructor(t=process.cwd(),e={}){const{nocase:s=!0}=e;super(t,{...e,nocase:s})}}process.platform;const Je="win32"===process.platform?qe:"darwin"===process.platform?Ze:Ve;class Ke{#Jt;#Kt;#Yt;length;#Xt;#Qt;#te;#ee;#se;#ie;#re=!0;constructor(t,e,s,i){if(!(t.length>=1))throw new TypeError("empty pattern list");if(!(e.length>=1))throw new TypeError("empty glob list");if(e.length!==t.length)throw new TypeError("mismatched pattern list and glob list lengths");if(this.length=t.length,s<0||s>=this.length)throw new TypeError("index out of range");if(this.#Jt=t,this.#Kt=e,this.#Yt=s,this.#Xt=i,0===this.#Yt)if(this.isUNC()){const[t,e,s,i,...r]=this.#Jt,[n,h,o,a,...l]=this.#Kt;""===r[0]&&(r.shift(),l.shift());const c=[t,e,s,i,""].join("/"),p=[n,h,o,a,""].join("/");this.#Jt=[c,...r],this.#Kt=[p,...l],this.length=this.#Jt.length}else if(this.isDrive()||this.isAbsolute()){const[t,...e]=this.#Jt,[s,...i]=this.#Kt;""===e[0]&&(e.shift(),i.shift());const r=t+"/",n=s+"/";this.#Jt=[r,...e],this.#Kt=[n,...i],this.length=this.#Jt.length}}pattern(){return this.#Jt[this.#Yt]}isString(){return"string"==typeof this.#Jt[this.#Yt]}isGlobstar(){return this.#Jt[this.#Yt]===kt}isRegExp(){return this.#Jt[this.#Yt]instanceof RegExp}globString(){return this.#te=this.#te||(0===this.#Yt?this.isAbsolute()?this.#Kt[0]+this.#Kt.slice(1).join("/"):this.#Kt.join("/"):this.#Kt.slice(this.#Yt).join("/"))}hasMore(){return this.length>this.#Yt+1}rest(){return void 0!==this.#Qt?this.#Qt:this.hasMore()?(this.#Qt=new Ke(this.#Jt,this.#Kt,this.#Yt+1,this.#Xt),this.#Qt.#ie=this.#ie,this.#Qt.#se=this.#se,this.#Qt.#ee=this.#ee,this.#Qt):this.#Qt=null}isUNC(){const t=this.#Jt;return void 0!==this.#se?this.#se:this.#se="win32"===this.#Xt&&0===this.#Yt&&""===t[0]&&""===t[1]&&"string"==typeof t[2]&&!!t[2]&&"string"==typeof t[3]&&!!t[3]}isDrive(){const t=this.#Jt;return void 0!==this.#ee?this.#ee:this.#ee="win32"===this.#Xt&&0===this.#Yt&&this.length>1&&"string"==typeof t[0]&&/^[a-z]:$/i.test(t[0])}isAbsolute(){const t=this.#Jt;return void 0!==this.#ie?this.#ie:this.#ie=""===t[0]&&t.length>1||this.isDrive()||this.isUNC()}root(){const t=this.#Jt[0];return"string"==typeof t&&this.isAbsolute()&&0===this.#Yt?t:""}checkFollowGlobstar(){return!(0===this.#Yt||!this.isGlobstar()||!this.#re)}markFollowGlobstar(){return!(0===this.#Yt||!this.isGlobstar()||!this.#re)&&(this.#re=!1,!0)}}const Ye="object"==typeof process&&process&&"string"==typeof process.platform?process.platform:"linux";class Xe{relative;relativeChildren;absolute;absoluteChildren;constructor(t,{nobrace:e,nocase:s,noext:i,noglobstar:r,platform:n=Ye}){this.relative=[],this.absolute=[],this.relativeChildren=[],this.absoluteChildren=[];const h={dot:!0,nobrace:e,nocase:s,noext:i,noglobstar:r,optimizationLevel:2,platform:n,nocomment:!0,nonegate:!0};for(const e of t){const t=new Tt(e,h);for(let e=0;e<t.set.length;e++){const s=t.set[e],i=t.globParts[e];if(!s||!i)throw new Error("invalid pattern object");const r=new Ke(s,i,0,n),o=new Tt(r.globString(),h),a="**"===i[i.length-1],l=r.isAbsolute();l?this.absolute.push(o):this.relative.push(o),a&&(l?this.absoluteChildren.push(o):this.relativeChildren.push(o))}}}ignored(t){const e=t.fullpath(),s=`${e}/`,i=t.relative()||".",r=`${i}/`;for(const t of this.relative)if(t.match(i)||t.match(r))return!0;for(const t of this.absolute)if(t.match(e)||t.match(s))return!0;return!1}childrenIgnored(t){const e=t.fullpath()+"/",s=(t.relative()||".")+"/";for(const t of this.relativeChildren)if(t.match(s))return!0;for(const t of this.absoluteChildren)if(t.match(e))return!0;return!1}}class Qe{store;constructor(t=new Map){this.store=t}copy(){return new Qe(new Map(this.store))}hasWalked(t,e){return this.store.get(t.fullpath())?.has(e.globString())}storeWalked(t,e){const s=t.fullpath(),i=this.store.get(s);i?i.add(e.globString()):this.store.set(s,new Set([e.globString()]))}}class ts{store=new Map;add(t,e,s){const i=(e?2:0)|(s?1:0),r=this.store.get(t);this.store.set(t,void 0===r?i:i&r)}entries(){return[...this.store.entries()].map((([t,e])=>[t,!!(2&e),!!(1&e)]))}}class es{store=new Map;add(t,e){if(!t.canReaddir())return;const s=this.store.get(t);s?s.find((t=>t.globString()===e.globString()))||s.push(e):this.store.set(t,[e])}get(t){const e=this.store.get(t);if(!e)throw new Error("attempting to walk unknown path");return e}entries(){return this.keys().map((t=>[t,this.store.get(t)]))}keys(){return[...this.store.keys()].filter((t=>t.canReaddir()))}}class ss{hasWalkedCache;matches=new ts;subwalks=new es;patterns;follow;dot;opts;constructor(t,e){this.opts=t,this.follow=!!t.follow,this.dot=!!t.dot,this.hasWalkedCache=e?e.copy():new Qe}processPatterns(t,e){this.patterns=e;const s=e.map((e=>[t,e]));for(let[t,e]of s){this.hasWalkedCache.storeWalked(t,e);const s=e.root(),i=e.isAbsolute()&&!1!==this.opts.absolute;if(s){t=t.resolve("/"===s&&void 0!==this.opts.root?this.opts.root:s);const i=e.rest();if(!i){this.matches.add(t,!0,!1);continue}e=i}if(t.isENOENT())continue;let r,n,h=!1;for(;"string"==typeof(r=e.pattern())&&(n=e.rest());){const s=t.resolve(r);t=s,e=n,h=!0}if(r=e.pattern(),n=e.rest(),h){if(this.hasWalkedCache.hasWalked(t,e))continue;this.hasWalkedCache.storeWalked(t,e)}if("string"!=typeof r)if(r===kt){(!t.isSymbolicLink()||this.follow||e.checkFollowGlobstar())&&this.subwalks.add(t,e);const s=n?.pattern(),r=n?.rest();if(n&&(""!==s&&"."!==s||r)){if(".."===s){const e=t.parent||t;r?this.hasWalkedCache.hasWalked(e,r)||this.subwalks.add(e,r):this.matches.add(e,i,!0)}}else this.matches.add(t,i,""===s||"."===s)}else r instanceof RegExp&&this.subwalks.add(t,e);else{const e=".."===r||""===r||"."===r;this.matches.add(t.resolve(r),i,e)}}return this}subwalkTargets(){return this.subwalks.keys()}child(){return new ss(this.opts,this.hasWalkedCache)}filterEntries(t,e){const s=this.subwalks.get(t),i=this.child();for(const t of e)for(const e of s){const s=e.isAbsolute(),r=e.pattern(),n=e.rest();r===kt?i.testGlobstar(t,e,n,s):r instanceof RegExp?i.testRegExp(t,r,n,s):i.testString(t,r,n,s)}return i}testGlobstar(t,e,s,i){if(!this.dot&&t.name.startsWith(".")||(e.hasMore()||this.matches.add(t,i,!1),t.canReaddir()&&(this.follow||!t.isSymbolicLink()?this.subwalks.add(t,e):t.isSymbolicLink()&&(s&&e.checkFollowGlobstar()?this.subwalks.add(t,s):e.markFollowGlobstar()&&this.subwalks.add(t,e)))),s){const e=s.pattern();if("string"==typeof e&&".."!==e&&""!==e&&"."!==e)this.testString(t,e,s.rest(),i);else if(".."===e){const e=t.parent||t;this.subwalks.add(e,s)}else e instanceof RegExp&&this.testRegExp(t,e,s.rest(),i)}}testRegExp(t,e,s,i){e.test(t.name)&&(s?this.subwalks.add(t,s):this.matches.add(t,i,!1))}testString(t,e,s,i){t.isNamed(e)&&(s?this.subwalks.add(t,s):this.matches.add(t,i,!1))}}class is{path;patterns;opts;seen=new Set;paused=!1;aborted=!1;#ne=[];#he;#oe;signal;maxDepth;constructor(t,e,s){this.patterns=t,this.path=e,this.opts=s,this.#oe=s.posix||"win32"!==s.platform?"/":"\\",s.ignore&&(this.#he=((t,e)=>"string"==typeof t?new Xe([t],e):Array.isArray(t)?new Xe(t,e):t)(s.ignore,s)),this.maxDepth=s.maxDepth||1/0,s.signal&&(this.signal=s.signal,this.signal.addEventListener("abort",(()=>{this.#ne.length=0})))}#ae(t){return this.seen.has(t)||!!this.#he?.ignored?.(t)}#le(t){return!!this.#he?.childrenIgnored?.(t)}pause(){this.paused=!0}resume(){if(this.signal?.aborted)return;let t;for(this.paused=!1;!this.paused&&(t=this.#ne.shift());)t()}onResume(t){this.signal?.aborted||(this.paused?this.#ne.push(t):t())}async matchCheck(t,e){if(e&&this.opts.nodir)return;let s;if(this.opts.realpath){if(s=t.realpathCached()||await t.realpath(),!s)return;t=s}const i=t.isUnknown()||this.opts.stat;return this.matchCheckTest(i?await t.lstat():t,e)}matchCheckTest(t,e){return!t||!(this.maxDepth===1/0||t.depth()<=this.maxDepth)||e&&!t.canReaddir()||this.opts.nodir&&t.isDirectory()||this.#ae(t)?void 0:t}matchCheckSync(t,e){if(e&&this.opts.nodir)return;let s;if(this.opts.realpath){if(s=t.realpathCached()||t.realpathSync(),!s)return;t=s}const i=t.isUnknown()||this.opts.stat;return this.matchCheckTest(i?t.lstatSync():t,e)}matchFinish(t,e){if(this.#ae(t))return;const s=void 0===this.opts.absolute?e:this.opts.absolute;this.seen.add(t);const i=this.opts.mark&&t.isDirectory()?this.#oe:"";if(this.opts.withFileTypes)this.matchEmit(t);else if(s){const e=this.opts.posix?t.fullpathPosix():t.fullpath();this.matchEmit(e+i)}else{const e=this.opts.posix?t.relativePosix():t.relative(),s=this.opts.dotRelative&&!e.startsWith(".."+this.#oe)?"."+this.#oe:"";this.matchEmit(e?s+e+i:"."+i)}}async match(t,e,s){const i=await this.matchCheck(t,s);i&&this.matchFinish(i,e)}matchSync(t,e,s){const i=this.matchCheckSync(t,s);i&&this.matchFinish(i,e)}walkCB(t,e,s){this.signal?.aborted&&s(),this.walkCB2(t,e,new ss(this.opts),s)}walkCB2(t,e,s,i){if(this.#le(t))return i();if(this.signal?.aborted&&i(),this.paused)return void this.onResume((()=>this.walkCB2(t,e,s,i)));s.processPatterns(t,e);let r=1;const n=()=>{0==--r&&i()};for(const[t,e,i]of s.matches.entries())this.#ae(t)||(r++,this.match(t,e,i).then((()=>n())));for(const t of s.subwalkTargets()){if(this.maxDepth!==1/0&&t.depth()>=this.maxDepth)continue;r++;const e=t.readdirCached();t.calledReaddir()?this.walkCB3(t,e,s,n):t.readdirCB(((e,i)=>this.walkCB3(t,i,s,n)),!0)}n()}walkCB3(t,e,s,i){s=s.filterEntries(t,e);let r=1;const n=()=>{0==--r&&i()};for(const[t,e,i]of s.matches.entries())this.#ae(t)||(r++,this.match(t,e,i).then((()=>n())));for(const[t,e]of s.subwalks.entries())r++,this.walkCB2(t,e,s.child(),n);n()}walkCBSync(t,e,s){this.signal?.aborted&&s(),this.walkCB2Sync(t,e,new ss(this.opts),s)}walkCB2Sync(t,e,s,i){if(this.#le(t))return i();if(this.signal?.aborted&&i(),this.paused)return void this.onResume((()=>this.walkCB2Sync(t,e,s,i)));s.processPatterns(t,e);let r=1;const n=()=>{0==--r&&i()};for(const[t,e,i]of s.matches.entries())this.#ae(t)||this.matchSync(t,e,i);for(const t of s.subwalkTargets()){if(this.maxDepth!==1/0&&t.depth()>=this.maxDepth)continue;r++;const e=t.readdirSync();this.walkCB3Sync(t,e,s,n)}n()}walkCB3Sync(t,e,s,i){s=s.filterEntries(t,e);let r=1;const n=()=>{0==--r&&i()};for(const[t,e,i]of s.matches.entries())this.#ae(t)||this.matchSync(t,e,i);for(const[t,e]of s.subwalks.entries())r++,this.walkCB2Sync(t,e,s.child(),n);n()}}class rs extends is{matches;constructor(t,e,s){super(t,e,s),this.matches=new Set}matchEmit(t){this.matches.add(t)}async walk(){if(this.signal?.aborted)throw this.signal.reason;return this.path.isUnknown()&&await this.path.lstat(),await new Promise(((t,e)=>{this.walkCB(this.path,this.patterns,(()=>{this.signal?.aborted?e(this.signal.reason):t(this.matches)}))})),this.matches}walkSync(){if(this.signal?.aborted)throw this.signal.reason;return this.path.isUnknown()&&this.path.lstatSync(),this.walkCBSync(this.path,this.patterns,(()=>{if(this.signal?.aborted)throw this.signal.reason})),this.matches}}class ns extends is{results;constructor(t,e,s){super(t,e,s),this.results=new xe({signal:this.signal,objectMode:!0}),this.results.on("drain",(()=>this.resume())),this.results.on("resume",(()=>this.resume()))}matchEmit(t){this.results.write(t),this.results.flowing||this.pause()}stream(){const t=this.path;return t.isUnknown()?t.lstat().then((()=>{this.walkCB(t,this.patterns,(()=>this.results.end()))})):this.walkCB(t,this.patterns,(()=>this.results.end())),this.results}streamSync(){return this.path.isUnknown()&&this.path.lstatSync(),this.walkCBSync(this.path,this.patterns,(()=>this.results.end())),this.results}}const hs="object"==typeof process&&process&&"string"==typeof process.platform?process.platform:"linux";class os{absolute;cwd;root;dot;dotRelative;follow;ignore;magicalBraces;mark;matchBase;maxDepth;nobrace;nocase;nodir;noext;noglobstar;pattern;platform;realpath;scurry;stat;signal;windowsPathsNoEscape;withFileTypes;opts;patterns;constructor(t,e){if(!e)throw new TypeError("glob options required");if(this.withFileTypes=!!e.withFileTypes,this.signal=e.signal,this.follow=!!e.follow,this.dot=!!e.dot,this.dotRelative=!!e.dotRelative,this.nodir=!!e.nodir,this.mark=!!e.mark,e.cwd?(e.cwd instanceof URL||e.cwd.startsWith("file://"))&&(e.cwd=i(e.cwd)):this.cwd="",this.cwd=e.cwd||"",this.root=e.root,this.magicalBraces=!!e.magicalBraces,this.nobrace=!!e.nobrace,this.noext=!!e.noext,this.realpath=!!e.realpath,this.absolute=e.absolute,this.noglobstar=!!e.noglobstar,this.matchBase=!!e.matchBase,this.maxDepth="number"==typeof e.maxDepth?e.maxDepth:1/0,this.stat=!!e.stat,this.ignore=e.ignore,this.withFileTypes&&void 0!==this.absolute)throw new Error("cannot set absolute and withFileTypes:true");if("string"==typeof t&&(t=[t]),this.windowsPathsNoEscape=!!e.windowsPathsNoEscape||!1===e.allowWindowsEscape,this.windowsPathsNoEscape&&(t=t.map((t=>t.replace(/\\/g,"/")))),this.matchBase){if(e.noglobstar)throw new TypeError("base matching requires globstar");t=t.map((t=>t.includes("/")?t:`./**/${t}`))}if(this.pattern=t,this.platform=e.platform||hs,this.opts={...e,platform:this.platform},e.scurry){if(this.scurry=e.scurry,void 0!==e.nocase&&e.nocase!==e.scurry.nocase)throw new Error("nocase option contradicts provided scurry option")}else{const t="win32"===e.platform?qe:"darwin"===e.platform?Ze:e.platform?Ve:Je;this.scurry=new t(this.cwd,{nocase:e.nocase,fs:e.fs})}this.nocase=this.scurry.nocase;const s="darwin"===this.platform||"win32"===this.platform,r={...e,dot:this.dot,matchBase:this.matchBase,nobrace:this.nobrace,nocase:this.nocase,nocaseMagicOnly:s,nocomment:!0,noext:this.noext,nonegate:!0,optimizationLevel:2,platform:this.platform,windowsPathsNoEscape:this.windowsPathsNoEscape,debug:!!this.opts.debug},n=this.pattern.map((t=>new Tt(t,r))),[h,o]=n.reduce(((t,e)=>(t[0].push(...e.set),t[1].push(...e.globParts),t)),[[],[]]);this.patterns=h.map(((t,e)=>{const s=o[e];if(!s)throw new Error("invalid pattern object");return new Ke(t,s,0,this.platform)}))}async walk(){return[...await new rs(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase}).walk()]}walkSync(){return[...new rs(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase}).walkSync()]}stream(){return new ns(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase}).stream()}streamSync(){return new ns(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase}).streamSync()}iterateSync(){return this.streamSync()[Symbol.iterator]()}[Symbol.iterator](){return this.iterateSync()}iterate(){return this.stream()[Symbol.asyncIterator]()}[Symbol.asyncIterator](){return this.iterate()}}function as(t,e={}){return new os(t,e).streamSync()}function ls(t,e={}){return new os(t,e).stream()}function cs(t,e={}){return new os(t,e).walkSync()}async function ps(t,e={}){return new os(t,e).walk()}function ds(t,e={}){return new os(t,e).iterateSync()}function us(t,e={}){return new os(t,e).iterate()}const fs=as,gs=Object.assign(ls,{sync:as}),ms=ds,ws=Object.assign(us,{sync:ds}),ys=Object.assign(cs,{stream:as,iterate:ds}),bs=Object.assign(ps,{glob:ps,globSync:cs,sync:ys,globStream:ls,stream:gs,globStreamSync:as,streamSync:fs,globIterate:us,iterate:ws,globIterateSync:ds,iterateSync:ms,Glob:os,hasMagic:(t,e={})=>{Array.isArray(t)||(t=[t]);for(const s of t)if(new Tt(s,e).hasMagic())return!0;return!1},escape:Q,unescape:$});bs.glob=bs;export{cs as g};
